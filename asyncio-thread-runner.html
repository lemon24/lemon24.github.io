












<!doctype html>

<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" href="/_static/spectre.css">
<link rel="stylesheet" href="/_static/pygments.css">
<link rel="stylesheet" href="/_static/style.css">

<link rel="alternate" type="application/atom+xml" title="Atom feed" href="/_feed/index.xml" />

<link rel="icon" href="/_static/xo-system-icon.svg">
<link rel="apple-touch-icon" href="/_static/xo-system-icon.svg">







<title>Announcing asyncio-thread-runner: you can have a little async (as a treat) - death and gravity</title>
<meta name="description" content="Back in 2023, we made a thing for running async code from sync code. I&#39;m happy to announce that it is now available on PyPI as asyncio-thread-runner." />


<meta property="og:title" content="Announcing asyncio-thread-runner: you can have a little async (as a treat)">
<meta property="og:site_name" content="death and gravity">
<meta property="og:type" content="article">
<meta property="og:url" content="https://death.andgravity.com/asyncio-thread-runner">
<meta property="og:description" content="Back in 2023, we made a thing for running async code from sync code. I&#39;m happy to announce that it is now available on PyPI as asyncio-thread-runner.">



<script>
/* https://css-tricks.com/the-trick-to-viewport-units-on-mobile/ */
function set_vh() {
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
}
/* we do it once, now, *and* on every resize */
set_vh();
window.addEventListener('resize', set_vh);
</script>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4RY2QR580X"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', "G-4RY2QR580X");
</script>



<div class="main container grid-lg">


<header>
<nav>
<ul class="breadcrumb">

<li class="breadcrumb-item">
    <a href="/">death and gravity</a>
</li>

</ul>
</nav>

<h1 class="heading-noindex">Announcing asyncio-thread-runner: you can have a little async (as a treat)</h1>

<p class="text-gray text-nowrap">



<small>
<span class="tooltip" data-tooltip="published on 2025-08-22">August 2025</span>
∙ two minute read
∙
</small><span class="share-icons">
<a
    class="share-icon pycoders"
    href="https://pycoders.com/submissions"
    target="_blank"
>PyCoder's Weekly</a>
<a
    class="share-icon hacker-news"
    href="https://news.ycombinator.%63%6f%6d/submitlink?u=https%3A//death.andgravity.com/asyncio-thread-runner&t=Announcing%20asyncio-thread-runner%3A%20you%20can%20have%20a%20little%20async%20%28as%C2%A0a%C2%A0treat%29"
>HN</a>
<a
    class="share-icon bluesky"
    href="https://bsky.%61%70%70/intent/compose?text=Announcing%20asyncio-thread-runner%3A%20you%20can%20have%20a%20little%20async%20%28as%C2%A0a%C2%A0treat%29%20https%3A//death.andgravity.com/asyncio-thread-runner"
>Bluesky</a>
<!--
<a
    class="share-icon reddit"
    href="https://www.reddit.%63%6f%6d/%73%75%62%6d%69%74?url=https%3A//death.andgravity.com/asyncio-thread-runner&title=Announcing%20asyncio-thread-runner%3A%20you%20can%20have%20a%20little%20async%20%28as%C2%A0a%C2%A0treat%29"
>Reddit</a>
-->
<a
    class="share-icon linkedin"
    href="https://www.linkedin.%63%6f%6d/sharing/share-offsite/?url=https%3A//death.andgravity.com/asyncio-thread-runner"
>linkedin</a>
<a
    class="share-icon twitter"
    href="https://twitter.%63%6f%6d/%73%68%61%72%65?text=Announcing%20asyncio-thread-runner%3A%20you%20can%20have%20a%20little%20async%20%28as%C2%A0a%C2%A0treat%29&url=https%3A//death.andgravity.com/asyncio-thread-runner&via=_andgravity"
>Twitter</a>
</span>


</p>






</header>


<main class="content columns">
<div class="column col-sm-12 col-md-10 col-8">

<p>Hi there!</p>
<p>Back in 2023, we made a thing for
<a class="internal" href="/asyncio-bridge">running async code from sync code</a>.</p>
<p>I'm happy to announce that you can now install it from <a class="external" href="https://pypi.org/project/asyncio-thread-runner">PyPI</a>,
and read the
documented, tested, type-annotated code
on <a class="external" href="https://github.com/lemon24/asyncio-thread-runner">GitHub</a>! <a class="external" href="https://github.com/lemon24/asyncio-thread-runner">⭐️</a>
Without further ado:</p>
<hr />
<p><strong><a class="external" href="https://pypi.org/project/asyncio-thread-runner">asyncio-thread-runner</a></strong> allows you to run async code from sync code.</p>
<p>This is useful when you're doing some sync stuff, but:</p>
<ul>
<li>you also need to do some async stuff, <strong>without</strong> making <strong>everything async</strong></li>
<li>maybe the sync stuff is an existing application</li>
<li>maybe you still want to use your favorite sync library</li>
<li>or maybe you need just a little async, without having to pay the full price</li>
</ul>
<p>Features:</p>
<ul>
<li>unlike <a class="external" href="https://docs.python.org/3/library/asyncio-runner.html#asyncio.run">asyncio.run()</a>, it provides a <strong>long-lived event loop</strong></li>
<li>unlike <a class="external" href="https://docs.python.org/3/library/asyncio-runner.html#asyncio.Runner">asyncio.Runner</a>, you can use it from <strong>multiple threads</strong></li>
<li>it allows you to use <strong>async context managers</strong> and <strong>iterables</strong> from sync code</li>
<li>check out <a class="external" href="https://death.andgravity.com/asyncio-bridge">this article</a> for why these are useful</li>
</ul>
<p>Usage:</p>
<div class="highlight code-container"><pre class="code" data-lang="Bash"><span></span><code>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>asyncio-thread-runner
</code></pre></div>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">double</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span>
<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">asyncio_thread_runner</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThreadRunner</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">runner</span> <span class="o">=</span> <span class="n">ThreadRunner</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">double</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="mi">4</span>
</code></pre></div>
<p>Annotated example:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">asyncio_thread_runner</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThreadRunner</span>

<span class="c1"># you can use ThreadRunner as a context manager,</span>
<span class="c1"># or call runner.close() when you&#39;re done with it</span>
<span class="k">with</span> <span class="n">ThreadRunner</span><span class="p">()</span> <span class="k">as</span> <span class="n">runner</span><span class="p">:</span>

    <span class="c1"># aiohttp.ClientSession() should be used as an async context manager,</span>
    <span class="c1"># enter_context() will exit the context on runner shutdown;</span>
    <span class="c1"># because instantiating ClientSession requires a running event loop,</span>
    <span class="c1"># we pass it as a factory instead of calling it in the main thread</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">)</span>

    <span class="c1"># session.get() returns an async context manager...</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://death.andgravity.com/asyncio-bridge&#39;</span><span class="p">)</span>
    <span class="c1"># which we turn into a normal one with wrap_context()</span>
    <span class="k">with</span> <span class="n">runner</span><span class="o">.</span><span class="n">wrap_context</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>

        <span class="c1"># response.content is an async iterator;</span>
        <span class="c1"># we turn it into a normal iterator with wrap_iter()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">runner</span><span class="o">.</span><span class="n">wrap_iter</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>

    <span class="c1"># &quot;got 935 lines&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;got&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="s1">&#39;lines&#39;</span><span class="p">)</span>
</code></pre></div>
<hr />
<p>That's it for now.</p>
<p><strong>Learned something new today?</strong> Share it with others, it really helps! <span class="text-large">
<span class="share-icons">
<a
    class="share-icon pycoders color"
    href="https://pycoders.com/submissions"
    target="_blank"
>PyCoder's Weekly</a>
<a
    class="share-icon hacker-news color"
    href="https://news.ycombinator.%63%6f%6d/submitlink?u=https%3A//death.andgravity.com/asyncio-thread-runner&t=Announcing%20asyncio-thread-runner%3A%20you%20can%20have%20a%20little%20async%20%28as%C2%A0a%C2%A0treat%29"
>HN</a>
<a
    class="share-icon bluesky color"
    href="https://bsky.%61%70%70/intent/compose?text=Announcing%20asyncio-thread-runner%3A%20you%20can%20have%20a%20little%20async%20%28as%C2%A0a%C2%A0treat%29%20https%3A//death.andgravity.com/asyncio-thread-runner"
>Bluesky</a>
<!--
<a
    class="share-icon reddit color"
    href="https://www.reddit.%63%6f%6d/%73%75%62%6d%69%74?url=https%3A//death.andgravity.com/asyncio-thread-runner&title=Announcing%20asyncio-thread-runner%3A%20you%20can%20have%20a%20little%20async%20%28as%C2%A0a%C2%A0treat%29"
>Reddit</a>
-->
<a
    class="share-icon linkedin color"
    href="https://www.linkedin.%63%6f%6d/sharing/share-offsite/?url=https%3A//death.andgravity.com/asyncio-thread-runner"
>linkedin</a>
<a
    class="share-icon twitter color"
    href="https://twitter.%63%6f%6d/%73%68%61%72%65?text=Announcing%20asyncio-thread-runner%3A%20you%20can%20have%20a%20little%20async%20%28as%C2%A0a%C2%A0treat%29&url=https%3A//death.andgravity.com/asyncio-thread-runner&via=_andgravity"
>Twitter</a>
</span>
</span></p>









</div>
</main>


<footer class="footer">
<p class="text-gray">
<a href="/">home</a>
∙ <a href="/_feed/index.xml">feed</a>
∙ <a href="/about">about</a>

∙ © 2021 lemon24



</footer>


</div>