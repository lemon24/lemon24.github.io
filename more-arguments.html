<!doctype html>

<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" href="/_static/spectre.css">
<link rel="stylesheet" href="/_static/pygments.css">
<link rel="stylesheet" href="/_static/style.css">

<link rel="alternate" type="application/atom+xml" title="Atom feed" href="/_feed/index.xml" />











<title>When your functions take the same arguments, consider using a class: counter-examples - death and gravity</title>




<script>
/* https://css-tricks.com/the-trick-to-viewport-units-on-mobile/ */
function set_vh() {
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
}
/* we do it once, now, *and* on every resize */
set_vh();
window.addEventListener('resize', set_vh);
</script>





<div class="main container grid-lg">


<header>
<nav>
<ul class="breadcrumb">

<li class="breadcrumb-item">
    <a href="/">death and gravity</a>
</li>

</ul>
</nav>

<h1 class="heading-noindex">When your functions take the same arguments, consider using a class: counter-examples</h1>

<p class="text-gray"><small>
<span>2021-06-05</span>



âˆ™ five minute read


</small></p>






</header>


<main class="content columns">
<div class="column col-sm-12 col-md-10 col-8">

<p>In <a href="/same-arguments">a previous article</a>,
I talk about this heuristic for using classes:</p>
<blockquote>
<p><strong>If you have functions that take the same set of arguments, consider using a class.</strong></p>
</blockquote>
<p>Thing is, <a href="/same-arguments#the-heuristic">heuristics don't always work</a>.</p>
<p>To make the most out of them, it helps to know what the exceptions are.</p>
<p>So, let's look at a few real-world examples
where functions that take the same arguments <strong>don't make a class</strong>.</p>
<h2 id="counter-example-two-sets-of-arguments">Counter-example: two sets of arguments<span class="headerlink"> <a href="#counter-example-two-sets-of-arguments" title="permalink">#</a></span></h2>
<p>Consider the following scenario:</p>
<p>We have a feed reader web app that can show a list of feeds,
and a list of entries (articles), filtered in various ways.</p>
<p>To decouple the web app logic from the code that actually queries the database
(say, because we also want to have a command-line interface),
we pull database-specific logic into functions
that take a database connection and other arguments,
do some queries on the database, and return the results.</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="k">def</span> <span class="nf">get_entries</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">important</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="o">...</span>
<span class="k">def</span> <span class="nf">get_entry_counts</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">important</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="o">...</span>
<span class="k">def</span> <span class="nf">search_entries</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">important</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="o">...</span>
<span class="k">def</span> <span class="nf">get_feeds</span><span class="p">(</span><span class="n">db</span><span class="p">):</span> <span class="o">...</span>
</code></pre></div>
<p>The usage pattern is like this:
the database connection is created once, at the start of the program;
then, the functions functions are called repeatedly with the same database,
but different options options.</p>
<hr />
<p>Taking this heuristic to the extreme, we'd end up with something like this:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="k">class</span> <span class="nc">Storage</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">important</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feed</span> <span class="o">=</span> <span class="n">feed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read</span> <span class="o">=</span> <span class="n">read</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_important</span> <span class="o">=</span> <span class="n">important</span>

    <span class="k">def</span> <span class="nf">get_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">get_entry_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">search_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">get_feeds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
</code></pre></div>
<p>This is clearly silly, and not very useful:
<code>Storage</code> can only filter entries in exactly one way,
and get_feeds() doesn't even use the options.</p>
<p>What that approach misses is a bit of nuance:
there isn't <em>one</em> set of arguments, there are <em>two</em>,
and one of them changes more often than the other.</p>
<p>It would be convenient to group these functions as methods on a <a href="https://en.wikipedia.org/wiki/Data_access_object">data access object</a>,
so whoever calls <code>get_entries()</code> doesn't have to care if they're coming
from a database, a flat file, or a list in memory.</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="k">class</span> <span class="nc">Storage</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">db</span>

    <span class="k">def</span> <span class="nf">get_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">important</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">get_entry_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">important</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">search_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">important</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">get_feeds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
</code></pre></div>
<p>The database connection is state, and Storage <em>encapsulates</em> that state.</p>
<h2 id="counter-example-data-classes">Counter-example: data classes<span class="headerlink"> <a href="#counter-example-data-classes" title="permalink">#</a></span></h2>
<p>OK, the above looks appropriate for the current state of the world.</p>
<p>Let's add some more requirements.</p>
<p>Because there's richer behavior that we want provide to the user (web app, CLI)
that implies more than just storing things,
we leave Storage to do <em>only</em> storage,
and wrap it in a Reader object that <em>has</em> a storage:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="k">class</span> <span class="nc">Reader</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span> <span class="o">=</span> <span class="n">storage</span>

    <span class="k">def</span> <span class="nf">get_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">important</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="o">...</span>  <span class="c1"># just calls self._storage.get_entries()</span>

    <span class="k">def</span> <span class="nf">update_feeds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>  <span class="c1"># retrieves feeds from the internet; calls various storage methods multiple times</span>
</code></pre></div>
<p>We also know Storage.get_entries() only gets called by Reader.get_entries();
furthermore, the arguments are rarely used directly by Storage.get_entries(),
most of the time they're passed along to helper functions.</p>
<p>Problem:
When we add a new entry filter option, we have to change the reader methods,
the storage methods, <em>and</em> the helpers.
And we expect more options to be added in the future.</p>
<p>So, we group the arguments in a class that contains only <em>data</em>, no behavior:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">Optional</span>

<span class="k">class</span> <span class="nc">EntryFilterOptions</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">feed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">read</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">important</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">class</span> <span class="nc">Storage</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">db</span>

    <span class="k">def</span> <span class="nf">get_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_options</span><span class="p">):</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">get_entry_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_options</span><span class="p">):</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">search_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">filter_options</span><span class="p">):</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">get_feeds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
</code></pre></div>
<p>Now, regardless of how many places the options need to pass through,
there are only two where it matters what they are:
in the Reader method, which builds the filter options object,
and where they get used (either a Storage method, or a helper).</p>
<p>It's important to stress that while we used the Python class <em>syntax</em>,
EntryFilterOptions is not a class/object in the traditional object-oriented programming sense,
since it has no behavior (sometimes, these are known as &quot;<a href="https://en.wikipedia.org/wiki/Passive_data_structure">passive data structures</a>&quot; or &quot;plain old data&quot;).
Ted Kaminski's <a href="https://www.tedinski.com/2018/01/23/data-objects-and-being-railroaded-into-misdesign.html">Data, objects, and how we're railroaded into poor design</a> discusses this distinction in more detail.</p>
<section class="admonition note">
<div class="admonition-text">
<p>In this example, we could have also used a plain class
 (setting the attributes in __init__ etc.),
 or <a href="https://docs.python.org/3/library/dataclasses.html">dataclass</a> (to take care of the boilerplate for us).
 Why I chose a named tuple is a discussion for another article.</p>
</div>
</section>
<section class="admonition tip">
<div class="admonition-text">
<p>I used type annotations with NamedTuple
 because it's an easy way of documenting what each options means,
 but <a href="/dataclasses#aside-named-tuples">you don't have to</a>.</p>
</div>
</section>
<p>TODO: example links</p>
<p>EntryFilterOptions: https://github.com/lemon24/reader/blob/1.18/src/reader/_types.py#L290
reader.get_entries: https://github.com/lemon24/reader/blob/1.18/src/reader/core.py#L880
storage.get_entries: https://github.com/lemon24/reader/blob/1.18/src/reader/_storage.py#L949</p>
<p>TODO: requests does it too</p>
<h3 id="why-not-a-dict">Why not a dict?<span class="headerlink"> <a href="#why-not-a-dict" title="permalink">#</a></span></h3>
<p>Instead of defining a whole new class,
we could've just used a dict like:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="p">{</span><span class="s1">&#39;feed&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span> <span class="s1">&#39;important&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">}</span>
</code></pre></div>
<p>But this has a number of drawbacks:</p>
<ul>
<li>Dicts are not type-checked.
<a href="https://docs.python.org/3/library/typing.html#typing.TypedDict">TypedDict</a> helps, but still doesn't prevent using the wrong keys <em>at runtime</em>.</li>
<li>Dicts don't work well with code completion.
Again, TypedDict can help smarter tools like PyCharm,
but doesn't in interactive mode or in IPython.</li>
<li>Dicts are mutable.
For our use case, immutability is a plus:
the options don't have much reason to change,
and it would be quite unexpected,
so it's useful to disallow it from happening.</li>
</ul>
<h3 id="why-not-take-kwargs">Why not take <code>**kwargs</code>?<span class="headerlink"> <a href="#why-not-take-kwargs" title="permalink">#</a></span></h3>
<p>Since we're talking about dicts,
why not make Reader.get_entries() etc.
take and pass <code>**kwargs</code> directly to EntryFilterOptions?</p>
<p>While shorter, this also breaks completion.</p>
<p>Furthermore, it makes the code less self-documenting:
even if you look at the Reader.get_entries() source,
you still don't immediately know what arguments it takes.
This doesn't matter as much for internal code,
but for the user-facing part of the API,
we don't mind making the code more verbose if it makes it easier to use.</p>
<p>Also, if we later introduce another data object
(say, to hangle pagination options),
we'll still have to write code to split the kwargs between the two.</p>
<h3 id="why-not-take-entryfilteroptions">Why not take EntryFilterOptions?<span class="headerlink"> <a href="#why-not-take-entryfilteroptions" title="permalink">#</a></span></h3>
<p>Why not make reader.get_entries() take an EntryFilterOptions, then?</p>
<p>Because that'd make things <em>too</em> verbose for the user:
they'd would have to import EntryFilterOptions,
build it, and <em>then</em> pass it to get_entries().
And frankly, it's not very idiomatic.</p>
<p>This difference between the Reader and Storage method signatures exists
because they're used differently:</p>
<ul>
<li>Reader methods are mostly called by external users in varied ways</li>
<li>Storage methods are mostly called by internal users (Reader) in a few ways</li>
</ul>














<form
    action="https://gmail.us7.list-manage.com/subscribe/post?u=9909b0e978d8d8d941bd3c8dc&amp;id=c61d63d661"
    method="post"
    id="embedded-subscribe-form"
    name="mc-embedded-subscribe-form"
    target="_blank"
    novalidate
    class="panel subscribe-form"

>
    <div class="panel-header text-large">

        Want to know when new articles come out?

    </div>
    <div class="panel-body">

        <p>Drop your email in the box below and I'll send new stuff straight to your inbox!</p>

        <div class="form-group col-6 col-xs-12 col-md-9">
        <input type="text" name="FNAME" id="mce-FNAME"
            class="form-input input-lg"
            placeholder="Your first name"
        >
        </div>

        <div class="form-group col-6 col-xs-12 col-md-9">
        <input type="email" name="EMAIL" id="mce-EMAIL"
            class="form-input input-lg"
            placeholder="Your email address"
        >
        </div>

        <!-- bot prevention-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_9909b0e978d8d8d941bd3c8dc_c61d63d661" tabindex="-1" value=""></div>

    </div>
    <div class="panel-footer">


        <div class="form-group">
        <input type="submit"  name="subscribe" id="mc-embedded-subscribe"
            class="btn btn-primary btn-lg"
            value="Subscribe"
        >
        </div>

    </div>

</form>




</div>
</main>


<footer class="footer">
<p class="text-gray">
<a href="/">home</a>
âˆ™ <a href="/_feed/index.xml">feed</a>
âˆ™ <a href="/about">about</a>

âˆ™ Â© 2021 lemon24



</footer>


</div>