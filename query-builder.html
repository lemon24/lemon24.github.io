<!doctype html>

<meta name="viewport" content="width=device-width" />


<link rel="stylesheet" href="/_static/spectre.css">
<link rel="stylesheet" href="/_static/pygments.css">
<link rel="stylesheet" href="/_static/style.css">

<link rel="alternate" type="application/atom+xml" title="Atom feed" href="/_feed/index.xml" />











<title>query-builder - death and gravity</title>


<script>
/* https://css-tricks.com/the-trick-to-viewport-units-on-mobile/ */
function set_vh() {
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
}
/* we do it once, now, *and* on every resize */
set_vh();
window.addEventListener('resize', set_vh);
</script>





<div class="main container grid-lg">


<header>
<nav>
<ul class="breadcrumb">

<li class="breadcrumb-item">
    <a href="/">death and gravity</a>
</li>

</ul>
</nav>

<h1>query-builder</h1>

<p class="text-gray"><small>





</small></p>






</header>


<main class="content columns">
<div class="column col-sm-12 col-md-10 col-8">

<p>building an sql query builder in 150 lines of Python</p>
<ul>
<li><p>intro</p>
<ul>
<li>real, useful, <em>used</em> library (in <code>reader</code>); not a toy</li>
<li>we'll cover why<ul>
<li>why it is useful</li>
<li>why it was the right decision for my project<ul>
<li>how I knew it wouldn't spiral out into huge project</li>
</ul>
</li>
<li>why not other things</li>
</ul>
</li>
<li>we'll cover how<ul>
<li>how I thought about the problem<ul>
<li>initial insight required</li>
<li>tiny bit of metaprogramming</li>
</ul>
</li>
<li>how I implemented it</li>
<li>how I tested it (or didn't)</li>
</ul>
</li>
<li>we'll talk about lessons learned, throught the thing</li>
<li>an example</li>
</ul>
</li>
<li><p>why is it useful</p>
<ul>
<li>makes conditional query building less verbose</li>
<li>provides standard way of describing a query, which enables<ul>
<li>composition; reuse by moving stuff into functions (example: apply filter options)</li>
<li>introspection (example: scrolling window queries)</li>
</ul>
</li>
</ul>
</li>
<li><p>why was it the right choice for my project</p>
<ul>
<li>no dependencies (reader is library, deps get passed down to users)</li>
<li>already high test coverage, could rely on existing higher level tests</li>
<li>already had the initial insight</li>
<li>didn't know it would be small<ul>
<li>did two prototypes before deciding to start</li>
<li>had a relatively clear list of requirements</li>
<li>more time was spent on adding annotations, and even more on refactoring for this article</li>
</ul>
</li>
<li>alternatives considered (TODO: include details from lemon24/reader#123)<ul>
<li>do nothing</li>
<li>disable bits of the query with booleans and hope the optimizer sorts it out</li>
<li>sqlbuilder.mini</li>
<li>JinjaSQL</li>
<li>SQLAlchemy</li>
<li>sqlpy (found it too late)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>TBD: how, lots of it</p>













</div>
</main>


<footer class="footer">
<p class="text-gray">
<a href="/">home</a>
∙ <a href="/_feed/index.xml">feed</a>
∙ <a href="/about">about</a>

∙ © 2021 lemon24



</footer>


</div>