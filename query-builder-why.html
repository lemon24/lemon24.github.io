












<!doctype html>

<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" href="/_static/spectre.css">
<link rel="stylesheet" href="/_static/pygments.css">
<link rel="stylesheet" href="/_static/style.css">

<link rel="alternate" type="application/atom+xml" title="Atom feed" href="/_feed/index.xml" />

<link rel="icon" href="/_static/xo-system-icon.svg">
<link rel="apple-touch-icon" href="/_static/xo-system-icon.svg">







<title>Why use an SQL query builder in the first place? - death and gravity</title>
<meta name="description" content="This is the second article in a series about writing an SQL query builder in 150 lines of Python, why I wrote it, how I thought about it, and the decisions I had to make. In this article, I talk about why I needed a query builder in the first place, with examples derived from real use cases I had for my feed reader library." />


<meta property="og:title" content="Why use an SQL query builder in the first place?">
<meta property="og:site_name" content="death and gravity">
<meta property="og:type" content="article">
<meta property="og:url" content="https://death.andgravity.com/query-builder-why">
<meta property="og:description" content="This is the second article in a series about writing an SQL query builder in 150 lines of Python, why I wrote it, how I thought about it, and the decisions I had to make. In this article, I talk about why I needed a query builder in the first place, with examples derived from real use cases I had for my feed reader library.">



<script>
/* https://css-tricks.com/the-trick-to-viewport-units-on-mobile/ */
function set_vh() {
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
}
/* we do it once, now, *and* on every resize */
set_vh();
window.addEventListener('resize', set_vh);
</script>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4RY2QR580X"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', "G-4RY2QR580X");
</script>



<div class="main container grid-lg">


<header>
<nav>
<ul class="breadcrumb">

<li class="breadcrumb-item">
    <a href="/">death and gravity</a>
</li>

</ul>
</nav>

<h1 class="heading-noindex">Why use an SQL query builder in the first place?</h1>

<p class="text-gray text-nowrap">



<small>
<span class="tooltip" data-tooltip="published on 2021-05-18">May 2021</span>
∙ eight minute read
∙
</small><span class="share-icons">
<a
    class="share-icon pycoders"
    href="https://pycoders.com/submissions"
    target="_blank"
>PyCoder's Weekly</a>
<a
    class="share-icon hacker-news"
    href="https://news.ycombinator.%63%6f%6d/submitlink?u=https%3A//death.andgravity.com/query-builder-why&t=Why%20use%20an%20SQL%20query%20builder%20in%20the%20first%20place%3F"
>HN</a>
<a
    class="share-icon reddit"
    href="https://www.reddit.%63%6f%6d/%73%75%62%6d%69%74?url=https%3A//death.andgravity.com/query-builder-why&title=Why%20use%20an%20SQL%20query%20builder%20in%20the%20first%20place%3F"
>Reddit</a>
<a
    class="share-icon linkedin"
    href="https://www.linkedin.%63%6f%6d/sharing/share-offsite/?url=https%3A//death.andgravity.com/query-builder-why"
>linkedin</a>
<a
    class="share-icon twitter"
    href="https://twitter.%63%6f%6d/%73%68%61%72%65?text=Why%20use%20an%20SQL%20query%20builder%20in%20the%20first%20place%3F&url=https%3A//death.andgravity.com/query-builder-why&via=_andgravity"
>Twitter</a>
</span>


</p>






</header>


<main class="content columns">
<div class="column col-sm-12 col-md-10 col-8">

<p><strong><a class="internal" href="/query-builder">Previously</a></strong></p>
<p>This is the second article <a class="internal" href="/query-builder">in a series</a> about
writing an SQL query builder in 150 lines of Python,
<strong>why I wrote it</strong>, <strong>how I thought about it</strong>, and the decisions I had to make.</p>
<p>Today, we'll talk about <strong>why I needed a query builder</strong> in the first place,
and how it:</p>
<ul>
<li><a class="anchor" href="#preventing-combinatorial-explosion">keeps down the number of queries</a></li>
<li><a class="anchor" href="#separation-of-concerns">leads to cleaner code and cleaner SQL</a></li>
<li><a class="anchor" href="#composition-and-reuse">enables composition and reuse</a></li>
<li><a class="anchor" href="#introspection">prevents needless repetition</a></li>
<li><a class="anchor" href="#abstraction">provides a base for higher level behavior</a></li>
</ul>
<p>The examples below are <em>actual use cases</em> I had for my feed <a class="external" href="https://github.com/lemon24/reader">reader</a> library.
In practice, they overlap a bit,
since they're different aspects of the same problem.</p>
<section class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The query builder shown below is not directly comparable with that of an ORM.
 Instead, it is an alternative to building <em>plain SQL</em> strings by hand.</p>
<p><strong>The caveats that apply to plain SQL apply to it as well:</strong>
 Using user-supplied values directly in an SQL query
 exposes you to <a class="external" href="https://en.wikipedia.org/wiki/SQL_injection">SQL injection</a> attacks.
 Instead, use <a class="external" href="https://en.wikipedia.org/wiki/SQL_injection#Parameterized_statements">parametrized queries</a> whenever possible,
 and <a class="external" href="https://en.wikipedia.org/wiki/SQL_injection#Escaping">escaping</a> only as a last resort.</p>
</section>
<section class="admonition note">
<p class="admonition-title">Note</p>
<p>Some of the problems I talk about in this article
 can be solved with <a class="external" href="https://en.wikipedia.org/wiki/Stored_procedure">stored procedures</a>.
 Regardless of <a class="external" href="https://wiki.c2.com/?StoredProceduresAreEvil">what people think of them</a>,
 they are a non-choice for me,
 since SQLite (<a class="internal" href="/own-query-builder#requirements-and-existing-libraries">my target database</a>) does not have stored procedures.</p>
</section>
<details>
<summary>Contents</summary>
<section class="toc">
<ul>
<li><a href="#the-problem">The problem</a></li>
<li><a href="#preventing-combinatorial-explosion">Preventing combinatorial explosion</a></li>
<li><a href="#separation-of-concerns">Separation of concerns</a></li>
<li><a href="#composition-and-reuse">Composition and reuse</a></li>
<li><a href="#intermission-scrolling-window-queries">Intermission: scrolling window queries</a></li>
<li><a href="#introspection">Introspection</a></li>
<li><a href="#abstraction">Abstraction</a></li>
</ul>
</section>
</details>
<h2 id="the-problem">The problem<span class="headerlink"> <a href="#the-problem" title="permalink">#</a></span></h2>
<p>You have a method that retrieves all or some of the entries from the database:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="k">def</span> <span class="nf">get_entries</span><span class="p">(</span>
    <span class="n">feed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">entry</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
    <span class="n">read</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
    <span class="n">important</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
    <span class="n">has_enclosures</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
    <span class="n">sort</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;recent&#39;</span><span class="p">,</span> <span class="s1">&#39;random&#39;</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Entry</span><span class="p">]:</span> <span class="o">...</span>
</code></pre></div>
<p>In the end, the method queries the <code>entries</code> table.
The query changes depending on the arguments:
different columns are selected,
different WHERE expressions and ordering terms are used.</p>
<p>The simplest solution in terms of code is to have one query per variation;
if the method started with no arguments and they were added over time,
this may be a natural thing to do (initially).</p>
<p>Let's count the queries you'd need <code>get_entries()</code> above:</p>
<ul>
<li>all queries are <a class="external" href="https://docs.python.org/3/library/sqlite3.html#sqlite3-placeholders">parametrized</a>,
so the query doesn't change for different values
(e.g. if <code>feed</code> is not None, we add <code>WHERE feed = :feed</code>)</li>
<li>optional arguments are either <em>present</em> or <em>not present</em> (2 queries)<ul>
<li>to make queries more readable,
for optional boolean arguments I emit 3 queries:
one for True (<code>condition</code>), one for False (<code>NOT condition</code>),
and one for None (nothing added);
however, since it can be done with only 2 queries, we'll count 2</li>
</ul>
</li>
<li><code>sort</code> changes the query in more complicated ways,
but it currently has 2 values, so we'll count it as 2 queries
(additional sorts <em>can</em> be added in the future, though)</li>
</ul>
<p>So, there's 6 parameters with 2 variations each: 2<sup>6</sup> = <strong>64 variations</strong>!</p>
<p>I'm not sure having 64 different queries is such a good idea... 😕</p>
<section class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="external" href="https://reader.readthedocs.io/en/latest/api.html#reader.Reader.get_entries">real method</a> has one parameter that can take an
 <em>arbitrary number of tags</em> in a bunch of different formats
 (<code>True</code>, <code>['one']</code>, <code>[['one'], ['two']]</code>, <code>[['one', 'two']]</code>, ...).
 I don't know how to count that, so I left it out;
 even without it, the conclusion is the same.</p>
</section>
<h2 id="preventing-combinatorial-explosion">Preventing combinatorial explosion<span class="headerlink"> <a href="#preventing-combinatorial-explosion" title="permalink">#</a></span></h2>
<p>OK, what now?</p>
<p>The next easiest thing is to build the query by concatenating strings.
To keep things short, we'll only do <code>read</code> and <code>important</code>:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="k">def</span> <span class="nf">make_entries_query</span><span class="p">(</span><span class="n">read</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">important</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">where_snippets</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">read</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">where_snippets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;NOT&#39;</span><span class="si">}</span><span class="s2"> entries.read&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">important</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">where_snippets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">important</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;NOT&#39;</span><span class="si">}</span><span class="s2"> entries.important&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">where_snippets</span><span class="p">):</span>
        <span class="n">where_keyword</span> <span class="o">=</span> <span class="s1">&#39;WHERE&#39;</span>
        <span class="n">where_snippet</span> <span class="o">=</span> <span class="s1">&#39; AND</span><span class="se">\n</span><span class="s1">            &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">where_snippets</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">where_keyword</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">where_snippet</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT</span>
<span class="s2">            entries.id,</span>
<span class="s2">            entries.title</span>
<span class="s2">        FROM entries</span>
<span class="s2">        </span><span class="si">{</span><span class="n">where_keyword</span><span class="si">}</span>
<span class="s2">            </span><span class="si">{</span><span class="n">where_snippet</span><span class="si">}</span>
<span class="s2">    &quot;&quot;&quot;</span>
</code></pre></div>
<p><code>make_entries_query(False, True)</code> outputs:</p>
<div class="highlight code-container"><pre class="code" data-lang="SQL"><span></span><code><span class="w">        </span><span class="k">SELECT</span>
<span class="w">            </span><span class="n">entries</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="n">entries</span><span class="p">.</span><span class="n">title</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">entries</span>
<span class="w">        </span><span class="k">WHERE</span>
<span class="w">             </span><span class="n">entries</span><span class="p">.</span><span class="k">read</span><span class="w"> </span><span class="k">AND</span>
<span class="w">            </span><span class="k">NOT</span><span class="w"> </span><span class="n">entries</span><span class="p">.</span><span class="n">important</span>
</code></pre></div>
<p>Not bad...</p>
<h2 id="separation-of-concerns">Separation of concerns<span class="headerlink"> <a href="#separation-of-concerns" title="permalink">#</a></span></h2>
<p>OK, it is a bit verbose,
especially as we add more snippets in other places.
Don't think so? Here's the full <a class="external" href="https://github.com/lemon24/reader/blob/7b47c88bb4e1388e7c5af1c269fb4a78e227120a/src/reader/_storage.py#L605-L746">original code</a>;
that's a lot of work just to <code>append()</code> some strings.</p>
<p>Also, while the SQL above is acceptable, it's not the best:</p>
<ul>
<li>it's needlessly indented</li>
<li>there's an extra space in front of <code>entries.read</code></li>
<li>the <code>where_snippets</code> joiner needs more spaces if we indent the function</li>
<li>(not shown above) multi-line snippets are tricky to indent properly</li>
</ul>
<p>We <em>could</em> wrap everything in <code>dedent</code>/<code>indent</code> calls,
but that would make things even more verbose.</p>
<p>What if there was an object with lots of <code>append()</code>-like methods?
...something like:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="k">def</span> <span class="nf">make_entries_query</span><span class="p">(</span><span class="n">read</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">important</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Query</span><span class="p">()</span>
        <span class="o">.</span><span class="n">SELECT</span><span class="p">(</span><span class="s1">&#39;entries.id&#39;</span><span class="p">,</span> <span class="s1">&#39;entries.title&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">FROM</span><span class="p">(</span><span class="s1">&#39;entries&#39;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">read</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span><span class="o">.</span><span class="n">WHERE</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;NOT&#39;</span><span class="si">}</span><span class="s2"> entries.read&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">important</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span><span class="o">.</span><span class="n">WHERE</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">important</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;NOT&#39;</span><span class="si">}</span><span class="s2"> entries.important&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">query</span>
</code></pre></div>
<p>The important bits are still there, but most of the noise went away.
Formatting is a <a class="external" href="https://en.wikipedia.org/wiki/Separation_of_concerns">separate concern</a>, so it happens somewhere else;
things are magically cleaned up, dedented, and stitched back together
into clean, regular SQL:</p>
<div class="highlight code-container"><pre class="code" data-lang="SQL"><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">entries</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
<span class="w">    </span><span class="n">entries</span><span class="p">.</span><span class="n">title</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">entries</span>
<span class="k">WHERE</span>
<span class="w">    </span><span class="n">entries</span><span class="p">.</span><span class="k">read</span><span class="w"> </span><span class="k">AND</span>
<span class="w">    </span><span class="k">NOT</span><span class="w"> </span><span class="n">entries</span><span class="p">.</span><span class="n">important</span>
</code></pre></div>
<h2 id="composition-and-reuse">Composition and reuse<span class="headerlink"> <a href="#composition-and-reuse" title="permalink">#</a></span></h2>
<p>Let's say we later add a <a class="external" href="https://reader.readthedocs.io/en/latest/api.html#reader.Reader.get_entry_counts">method to count entries</a>.</p>
<p>Surely, we'd want it to have the same filtering capabilities as <code>get_entries()</code>.
So we move that part into a function:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="k">def</span> <span class="nf">apply_filter_options</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">important</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">read</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span><span class="o">.</span><span class="n">WHERE</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;NOT&#39;</span><span class="si">}</span><span class="s2"> entries.read&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">important</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span><span class="o">.</span><span class="n">WHERE</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">important</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;NOT&#39;</span><span class="si">}</span><span class="s2"> entries.important&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">make_entry_counts_query</span><span class="p">(</span><span class="n">read</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">important</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Query</span><span class="p">()</span>
        <span class="o">.</span><span class="n">SELECT</span><span class="p">(</span>
            <span class="s1">&#39;count(*)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;coalesce(sum(read == 1), 0)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;coalesce(sum(important == 1), 0)&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">FROM</span><span class="p">(</span><span class="s2">&quot;entries&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">apply_filter_options</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">read</span><span class="p">,</span> <span class="n">important</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">query</span>
</code></pre></div>
<p>Why pass the query in, instead of just returning the WHERE snippets?
Because it allows doing <em>other kinds</em> of changes transparently:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="k">def</span> <span class="nf">apply_filter_options</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">updates_enabled</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">if</span> <span class="n">updates_enabled</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span><span class="o">.</span><span class="n">JOIN</span><span class="p">(</span><span class="s2">&quot;feeds ON feeds.url = entries.feed&quot;</span><span class="p">)</span>
        <span class="n">query</span><span class="o">.</span><span class="n">WHERE</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">updates_enabled</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;NOT&#39;</span><span class="si">}</span><span class="s2"> feeds.updates_enabled&quot;</span><span class="p">)</span>
</code></pre></div>
<p>The query builder offers a <strong>standard interface for making changes to a query</strong>,
which makes it easier to compose operations,
which in turn makes it easier to reuse logic.</p>
<p>If you find this a bit contrived,
check out <a class="external" href="https://github.com/lemon24/reader/blob/1.17/src/reader/_storage.py#L1409-L1479">this function</a> for a real-world example.</p>
<h2 id="intermission-scrolling-window-queries">Intermission: scrolling window queries<span class="headerlink"> <a href="#intermission-scrolling-window-queries" title="permalink">#</a></span></h2>
<p><em>If you're familiar with
scrolling window queries / cursor pagination / keyset pagination,
feel free to skip to the
<a class="anchor" href="#introspection">next section</a>.</em></p>
<p>Before we go forward, we need to learn how to implement pagination.</p>
<p>Assume we have a table like this:</p>
<div class="highlight code-container"><pre class="code" data-lang="sqlite3con"><span></span><code><span class="gp">sqlite&gt;</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">things</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="gp">sqlite&gt;</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">things</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">);</span>
</code></pre></div>
<p>Let's say we need to get the <code>things</code> sorted by <code>name</code>,
but split over multiple queries, each returning a 2-row page.
There are two main ways of doing it.</p>
<p>The obvious one is LIMIT+OFFSET:</p>
<div class="highlight code-container"><pre class="code" data-lang="sqlite3con"><span></span><code><span class="gp">sqlite&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">things</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">OFFSET</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="go">a</span>
<span class="go">b</span>
<span class="gp">sqlite&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">things</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">OFFSET</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="go">c</span>
</code></pre></div>
<p>This returns the correct answer, but has one big performance issue:
each query fetches <strong>and discards</strong> the rows up to OFFSET,
and then returns (at most) LIMIT rows;
the more data you have, and the nearer the end of the result set you are,
the slower this gets.</p>
<p>The other one is <a class="external" href="https://www.sqlite.org/rowvalue.html#scrolling_window_queries">scrolling window queries</a>
(also known as <em>cursor based pagination</em>):</p>
<div class="highlight code-container"><pre class="code" data-lang="sqlite3con"><span></span><code><span class="gp">sqlite&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">things</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="go">a</span>
<span class="go">b</span>
<span class="gp">sqlite&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">things</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s1">&#39;b&#39;</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="go">c</span>
</code></pre></div>
<p>Instead of using OFFSET to skip <em>n</em> rows,
it uses WHERE to skip to <em>after the last row</em> from the previous query,
using the sort key (the <em>cursor</em>).
While superficially the same,
now <strong>the query can use indices</strong>
to avoid fetching rows it doesn't need.</p>
<p>An additional benefit, unrelated to performance,
is that you won't get duplicate/missing results
if rows are inserted/deleted between queries.</p>
<section class="admonition tip">
<p class="admonition-title">Tip</p>
<p>See <a class="external" href="https://medium.com/swlh/why-you-shouldnt-use-offset-and-limit-for-your-pagination-4440e421ba87">this article</a> for a more detailed explanation,
 complete with a benchmark you can run yourself.</p>
</section>
<h2 id="introspection">Introspection<span class="headerlink"> <a href="#introspection" title="permalink">#</a></span></h2>
<p>Now that we're familiar with scrolling window queries,
let's do it for a real query:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="k">def</span> <span class="nf">make_feeds_query</span><span class="p">():</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">()</span><span class="o">.</span><span class="n">SELECT</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;coalesce(user_title, title)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">FROM</span><span class="p">(</span><span class="s1">&#39;feeds&#39;</span><span class="p">)</span>

    <span class="c1"># if sort == &#39;title&#39;:</span>
    <span class="n">query</span><span class="o">.</span><span class="n">SELECT</span><span class="p">((</span><span class="s2">&quot;title_sort&quot;</span><span class="p">,</span> <span class="s2">&quot;lower(coalesce(user_title, title))&quot;</span><span class="p">))</span>
    <span class="n">query</span><span class="o">.</span><span class="n">ORDER_BY</span><span class="p">(</span><span class="s1">&#39;title_sort&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">query</span>
</code></pre></div>
<p>This retrieves feeds sorted by title, preferring custom titles;
for feeds with the same title, it falls back to the primary key,
so the result stays consistent between queries.
I omitted other supported orderings for brevity.</p>
<p>To get the first page, we add a limit:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="n">query</span> <span class="o">=</span> <span class="n">make_feeds_query</span><span class="p">()</span>
<span class="n">query</span><span class="o">.</span><span class="n">LIMIT</span><span class="p">(</span><span class="s1">&#39;:limit&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight code-container"><pre class="code" data-lang="SQL"><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">url</span><span class="p">,</span>
<span class="w">    </span><span class="k">coalesce</span><span class="p">(</span><span class="n">user_title</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">),</span>
<span class="w">    </span><span class="k">lower</span><span class="p">(</span><span class="k">coalesce</span><span class="p">(</span><span class="n">user_title</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">title_sort</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">feeds</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span>
<span class="w">    </span><span class="n">title_sort</span><span class="p">,</span>
<span class="w">    </span><span class="n">url</span>
<span class="k">LIMIT</span>
<span class="w">    </span><span class="p">:</span><span class="k">limit</span>
</code></pre></div>
<p>After we run the query, we save the last sort key:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python console session"><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">first_page</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="n">params</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">last_result</span> <span class="o">=</span> <span class="n">first_page</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">last_result</span>
<span class="go">(&#39;file:feed.xml&#39;, &#39;Title&#39;, &#39;title&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">last</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">last_title_sort</span><span class="o">=</span><span class="n">last_result</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">last_url</span><span class="o">=</span><span class="n">last_result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div>
<p>To get the second page, we add a limit and a WHERE condition:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="n">query</span> <span class="o">=</span> <span class="n">make_feeds_query</span><span class="p">()</span>
<span class="n">query</span><span class="o">.</span><span class="n">LIMIT</span><span class="p">(</span><span class="s1">&#39;:limit&#39;</span><span class="p">)</span>
<span class="n">query</span><span class="o">.</span><span class="n">WHERE</span><span class="p">(</span><span class="s1">&#39;(title_sort, url) &gt; (:last_title_sort, :last_url)&#39;</span><span class="p">)</span>
</code></pre></div>
<p>...and use the last sort key from the previous page as query parameters:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python console session"><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">last</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">second_page</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="n">params</span><span class="p">)</span>
</code></pre></div>
<p>But, every time we do this,
we have to remember the indices of the sort key values in the result
and the parameter names for the current ordering.</p>
<p>There must be a better way.</p>
<p>The WHERE parameters don't actually <em>need</em> a descriptive name;
also, the computer <em>already knows</em> both what we're sorting by,
and where those things are in the result tuple –
it's right there in  <code>make_feeds_query()</code>.</p>
<p>Let's make the computer do the work, then.
To add the WHERE condition:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="n">query</span> <span class="o">=</span> <span class="n">make_feeds_query</span><span class="p">()</span>
<span class="n">query</span><span class="o">.</span><span class="n">LIMIT</span><span class="p">(</span><span class="s1">&#39;:limit&#39;</span><span class="p">)</span>

<span class="n">order_by_things</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ORDER BY&#39;</span><span class="p">]]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;:last_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">order_by_things</span><span class="p">))]</span>
<span class="c1"># use the query builder do the formatting (sneaky, but it works)</span>
<span class="n">comparison</span> <span class="o">=</span> <span class="n">Query</span><span class="p">({</span><span class="s1">&#39;(&#39;</span><span class="p">:</span> <span class="n">order_by_things</span><span class="p">,</span> <span class="s1">&#39;) &gt; (&#39;</span><span class="p">:</span><span class="n">labels</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]})</span>

<span class="n">query</span><span class="o">.</span><span class="n">WHERE</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">comparison</span><span class="p">))</span>
</code></pre></div>
<div class="highlight code-container"><pre class="code" data-lang="SQL"><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">url</span><span class="p">,</span>
<span class="w">    </span><span class="k">coalesce</span><span class="p">(</span><span class="n">user_title</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">),</span>
<span class="w">    </span><span class="k">lower</span><span class="p">(</span><span class="k">coalesce</span><span class="p">(</span><span class="n">user_title</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">title_sort</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">feeds</span>
<span class="k">WHERE</span>
<span class="w">    </span><span class="p">(</span>
<span class="w">        </span><span class="n">title_sort</span><span class="p">,</span>
<span class="w">        </span><span class="n">url</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="p">:</span><span class="n">last_0</span><span class="p">,</span>
<span class="w">        </span><span class="p">:</span><span class="n">last_1</span>
<span class="w">    </span><span class="p">)</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span>
<span class="w">    </span><span class="n">title_sort</span><span class="p">,</span>
<span class="w">    </span><span class="n">url</span>
<span class="k">LIMIT</span>
<span class="w">    </span><span class="p">:</span><span class="k">limit</span>
</code></pre></div>
<p>To extract the sort key parameters from the last result:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python console session"><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">order_by_things</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ORDER BY&#39;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">alias</span> <span class="ow">or</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SELECT&#39;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">last</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="sa">f</span><span class="s1">&#39;last_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">last_result</span><span class="p">[</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">order_by_things</span><span class="p">)</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">last</span>
<span class="go">{&#39;last_0&#39;: &#39;title&#39;, &#39;last_1&#39;: &#39;file:feed.xml&#39;}</span>
</code></pre></div>
<p>Now, we only need to specify what we're sorting by once, in <code>make_feeds_query()</code>.
Because the query builder provides a <strong>standard representation of a query</strong>,
we can inspect that programmatically,
and let the computer do the work itself.</p>
<p>Can we do better?</p>
<h2 id="abstraction">Abstraction<span class="headerlink"> <a href="#abstraction" title="permalink">#</a></span></h2>
<p>The pattern above seems quite useful,
but it's complicated enough I probably wouldn't get it right all the time;
I bet I missed some corner cases, too.</p>
<p>If only there was a way to tell the computer directly what I want:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="k">def</span> <span class="nf">make_feeds_query</span><span class="p">():</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">()</span><span class="o">.</span><span class="n">SELECT</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;coalesce(user_title, title)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">FROM</span><span class="p">(</span><span class="s1">&#39;feeds&#39;</span><span class="p">)</span>

    <span class="c1"># if sort == &#39;title&#39;:</span>
    <span class="n">query</span><span class="o">.</span><span class="n">SELECT</span><span class="p">((</span><span class="s2">&quot;title_sort&quot;</span><span class="p">,</span> <span class="s2">&quot;lower(coalesce(user_title, title))&quot;</span><span class="p">))</span>
    <span class="n">query</span><span class="o">.</span><span class="n">scrolling_window_order_by</span><span class="p">(</span><span class="s1">&#39;title_sort&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">query</span>
</code></pre></div>
<p>...and then have it execute the queries for me:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python console session"><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">make_feeds_query</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">first_page</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">paginated_query</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">first_page</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">((&#39;file:feed.xml&#39;, &#39;Title&#39;, &#39;title&#39;), (&#39;title&#39;, &#39;file:feed.xml&#39;))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">last</span> <span class="o">=</span> <span class="n">first_page</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div>
<div class="highlight code-container"><pre class="code" data-lang="Python console session"><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">make_feeds_query</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">second_page</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">paginated_query</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="n">last</span><span class="p">))</span>
</code></pre></div>
<p>Pretty neat, huh?</p>
<p>This is provided by a mixin that's not counted in the 150 lines –
but hey, <a class="external" href="https://github.com/djrobstep/sqlakeyset">not even SQLAlchemy has it built-in</a>.</p>
<hr />
<p>That's it for now.</p>
<p><strong>Learned something new today?</strong> Share this with others, it really helps! <span class="text-large">
<span class="share-icons">
<a
    class="share-icon pycoders color"
    href="https://pycoders.com/submissions"
    target="_blank"
>PyCoder's Weekly</a>
<a
    class="share-icon hacker-news color"
    href="https://news.ycombinator.%63%6f%6d/submitlink?u=https%3A//death.andgravity.com/query-builder-why&t=Why%20use%20an%20SQL%20query%20builder%20in%20the%20first%20place%3F"
>HN</a>
<a
    class="share-icon reddit color"
    href="https://www.reddit.%63%6f%6d/%73%75%62%6d%69%74?url=https%3A//death.andgravity.com/query-builder-why&title=Why%20use%20an%20SQL%20query%20builder%20in%20the%20first%20place%3F"
>Reddit</a>
<a
    class="share-icon linkedin color"
    href="https://www.linkedin.%63%6f%6d/sharing/share-offsite/?url=https%3A//death.andgravity.com/query-builder-why"
>linkedin</a>
<a
    class="share-icon twitter color"
    href="https://twitter.%63%6f%6d/%73%68%61%72%65?text=Why%20use%20an%20SQL%20query%20builder%20in%20the%20first%20place%3F&url=https%3A//death.andgravity.com/query-builder-why&via=_andgravity"
>Twitter</a>
</span>
</span></p>

<form
    action="https://gmail.us7.list-manage.com/subscribe/post?u=9909b0e978d8d8d941bd3c8dc&amp;id=c61d63d661&SIGNUP=query-builder-why"
    method="post"
    id="embedded-subscribe-form"
    name="mc-embedded-subscribe-form"
    target="_blank"
    novalidate
    class="panel subscribe-form"
>
    <div class="panel-header text-large">

        Want to know when new articles come out?

    </div>
    <div class="panel-body">

        <p>Drop your email in the box below and I'll send new stuff straight to your inbox!</p>

        <div class="form-group col-6 col-xs-12 col-md-9">
        <input type="text" name="FNAME" id="mce-FNAME"
            class="form-input input-lg"
            placeholder="Your first name"
        >
        </div>

        <div class="form-group col-6 col-xs-12 col-md-9">
        <input type="email" name="EMAIL" id="mce-EMAIL"
            class="form-input input-lg"
            placeholder="Your email address"
        >
        </div>

        <!-- bot prevention-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_9909b0e978d8d8d941bd3c8dc_c61d63d661" tabindex="-1" value=""></div>

    </div>
    <div class="panel-footer">

        <div class="form-group">
        <input type="submit"  name="subscribe" id="mc-embedded-subscribe"
            class="btn btn-primary btn-lg"
            value="Subscribe"
        >
        </div>

    </div>

</form>
<p><strong>Next: <a class="internal" href="/own-query-builder">Why I wrote my own SQL query builder</a></strong></p>










<hr>
<p>This is part of a series:</p>

<ul>


<li>
    <a href="/query-builder">SQL query builder in 150 lines of Python</a>



<li>
    <a href="/query-builder-why">Why use an SQL query builder in the first place?</a> <small class="text-gray">(this article)</small>



<li>
    <a href="/own-query-builder">Why I wrote my own SQL query builder (in Python)</a>



<li>
    <a href="/query-builder-how">Write an SQL query builder in 150 lines of Python!</a>


</ul>





</div>
</main>


<footer class="footer">
<p class="text-gray">
<a href="/">home</a>
∙ <a href="/_feed/index.xml">feed</a>
∙ <a href="/about">about</a>

∙ © 2021 lemon24



</footer>


</div>