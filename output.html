






<!doctype html>

<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" href="/_static/spectre.css">
<link rel="stylesheet" href="/_static/pygments.css">
<link rel="stylesheet" href="/_static/style.css">

<link rel="alternate" type="application/atom+xml" title="Atom feed" href="/_feed/index.xml" />

<link rel="icon" href="/_static/xo-system-icon.svg">
<link rel="apple-touch-icon" href="/_static/xo-system-icon.svg">







<title>Why you should still read the docs - death and gravity</title>



<meta property="og:title" content="Why you should still read the docs">
<meta property="og:site_name" content="death and gravity">
<meta property="og:type" content="article">
<meta property="og:url" content="https://death.andgravity.com/output">




<script>
/* https://css-tricks.com/the-trick-to-viewport-units-on-mobile/ */
function set_vh() {
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
}
/* we do it once, now, *and* on every resize */
set_vh();
window.addEventListener('resize', set_vh);
</script>





<div class="main container grid-lg">


<header>
<nav>
<ul class="breadcrumb">

<li class="breadcrumb-item">
    <a href="/">death and gravity</a>
</li>

</ul>
</nav>

<h1 class="heading-noindex">Why you should still read the docs</h1>

<p class="text-gray text-nowrap">



<small>
<span class="tooltip" data-tooltip="published on 2023-03-23">March 2023</span>
∙ nine minute read
∙
</small><span class="share-icons">
<a
    class="share-icon twitter"
    href="https://twitter.%63%6f%6d/%73%68%61%72%65?text=Why%20you%20should%20still%20read%20the%20docs&url=https%3A//death.andgravity.com/output&via=_andgravity"
>Twitter</a>
<a
    class="share-icon hacker-news"
    href="https://news.ycombinator.%63%6f%6d/submitlink?u=https%3A//death.andgravity.com/output&t=Why%20you%20should%20still%20read%20the%20docs"
>HN</a>
<a
    class="share-icon reddit"
    href="https://www.reddit.%63%6f%6d/%73%75%62%6d%69%74?url=https%3A//death.andgravity.com/output&title=Why%20you%20should%20still%20read%20the%20docs"
>Reddit</a>
</span>


</p>






</header>


<main class="content columns">
<div class="column col-sm-12 col-md-10 col-8">

<p>Do you feel you're <strong>fighting your tools</strong>?</p>
<p>Do you feel you're <strong>relying too much on autocomplete</strong> and inline documentation?
...always kinda guessing when using libraries?</p>
<p>Or maybe not, but getting things done <strong>just seems harder than it should be</strong>.</p>
<!-- should this say "advanced beginners"? -->
<p>This can have many causes,
but I've repeatedly seen junior developers struggle with a specific one,
not even fully aware they're struggling in the first place.</p>
<!-- As always, there must be a better way. -->
<p>This is a story about:</p>
<ul>
<li>why you should still read the docs</li>
<li>finding the right way of doing things</li>
<li>command-line interfaces</li>
</ul>
<p>tl;dr: <strong>Most <em>good</em> documentation won't show up in your IDE</strong> –
  rather, it is about <em>how</em> to use the library,
  and the <em>problem</em> the library is solving.</p>
<section class="toc">
<ul>
<li><a href="#an-example">An example</a>
<ul>
<li><a href="#the-path-is-hardcoded">The path is hardcoded</a></li>
<li><a href="#the-path-might-not-be-valid">The path might not be valid</a></li>
<li><a href="#the-path-to-what-exactly">The path to what, exactly?</a></li>
<li><a href="#standard-output">Standard output</a></li>
<li><a href="#by-default">... by default</a></li>
<li><a href="#discussion">Discussion</a></li>
</ul>
</li>
<li><a href="#good-libraries-educate">Good libraries educate</a></li>
<li><a href="#read-the-docs">Read the docs</a>
<ul>
<li><a href="#but-the-docs-suck">But the docs suck</a></li>
<li><a href="#but-i-m-using-lots-of-libraries">But I'm using lots of libraries</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</section>
<h2 id="an-example">An example<span class="headerlink"> <a href="#an-example" title="permalink">#</a></span></h2>
<p>OK, instead of telling you, let me show you –
we'll go through <em>one possible path</em> of developing something,
and stop along the way to point out how we're doing things.</p>
<hr />
<p>Say you're writing a command-line tool
that gets data from an API
and saves it in a CSV file.
It might look something like this:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">click</span>

<span class="k">def</span> <span class="nf">get_data</span><span class="p">():</span>
    <span class="c1"># pretend some API calls happen here</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Chaos&quot;</span><span class="p">,</span> <span class="s2">&quot;short_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Chs&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Discord&quot;</span><span class="p">,</span> <span class="s2">&quot;short_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Dsc&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Confusion&quot;</span><span class="p">,</span> <span class="s2">&quot;short_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Cfn&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bureaucracy&quot;</span><span class="p">,</span> <span class="s2">&quot;short_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bcy&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;The Aftermath&quot;</span><span class="p">,</span> <span class="s2">&quot;short_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Afm&quot;</span><span class="p">},</span>
    <span class="p">]</span>

<span class="k">def</span> <span class="nf">write_csv</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;calendar.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;short_name&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;short_name&#39;</span><span class="p">]])</span>

<span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the names of the Discordian seasons to calendar.csv.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">()</span>
    <span class="n">write_csv</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>

<p>Here it is in action:</p>
<div class="highlight code-container"><pre class="code" data-lang="Bash Session"><span></span><code><span class="gp">$ </span>python<span class="w"> </span>seasons.py<span class="w"> </span>--help
<span class="go">Usage: seasons.py [OPTIONS]</span>

<span class="go">  Retrieve the names of the Discordian seasons to calendar.csv.</span>

<span class="go">Options:</span>
<span class="go">  --help  Show this message and exit.</span>
<span class="gp">$ </span>python<span class="w"> </span>seasons.py
<span class="gp">$ </span>cat<span class="w"> </span>calendar.csv
<span class="go">name,short_name</span>
<span class="go">Chaos,Chs</span>
<span class="go">Discord,Dsc</span>
<span class="go">Confusion,Cfn</span>
<span class="go">Bureaucracy,Bcy</span>
<span class="go">The Aftermath,Afm</span>
</code></pre></div>
<p>You're using <a href="https://click.palletsprojects.com/">Click</a> because
it’s powerful but comes with sensible defaults.</p>
<p>This is pretty good code –
instead of calling <code>get_data()</code> <em>from</em> <code>write_csv()</code>,
you're passing its result <em>to</em> <code>write_csv()</code> –
in other words, instead of <em>hiding</em> the input,
you've <em>decoupled</em> it.<sup class="footnote-ref" id="fnref-1"><a href="#fn-1">1</a></sup></p>
<p>As a result,
<code>write_csv()</code> doesn't need to change when adding new arguments to <code>get_data()</code>,
and we can test it without monkeypatching <code>get_data()</code>:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="kn">import</span> <span class="nn">seasons</span>

<span class="n">DATA</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;short_name&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="s2">&quot;short_name&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">},</span>
<span class="p">]</span>
<span class="n">CSV_BYTES</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;name,short_name</span><span class="se">\r\n</span><span class="s2">one,1</span><span class="se">\r\n</span><span class="s2">two,2</span><span class="se">\r\n</span><span class="s2">&quot;</span>

<span class="k">def</span> <span class="nf">test_write_csv</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
    <span class="n">seasons</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">tmp_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;calendar.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">()</span> <span class="o">==</span> <span class="n">CSV_BYTES</span>
</code></pre></div>

<!--

# Too much monkey patching

Hmm... that's a bit involved.

Think about it – get_data() is *hidden* away,
but is still *coupled* to the things around it;
when get_data() needs a new argument:

* write_csv() will need to pass the argument through,
  even though it only cares about get_data()'s output
* we'll have to update the test to check the argument is passed around

.. literalinclude:: 10-data/seasons.py
    :lines: 23-27
    :linenos: no

.. literalinclude:: 10-data/seasons.py
    :lines: 16-17
    :linenos: no

The test is already simpler now:

.. literalinclude:: 10-data/test_seasons.py
    :lines: 9-
    :linenos: no

-->
<h3 id="the-path-is-hardcoded">The path is hardcoded<span class="headerlink"> <a href="#the-path-is-hardcoded" title="permalink">#</a></span></h3>
<p>But, what if you need to run it twice,
and save the output in different files?
This becomes useful as soon as the output can change.
Also, having to be in the right directory
when running it is not cool.</p>
<p>The obvious solution is to pass the path in:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--path&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the names of the Discordian seasons.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">()</span>
    <span class="n">write_csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</code></pre></div>

<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="k">def</span> <span class="nf">write_csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</code></pre></div>

<p>We're definitely on the right track here –
the test is shorter,
and we don't even need to monkeypatch the current working directory
anymore:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="k">def</span> <span class="nf">test_write_csv</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">):</span>
    <span class="n">out_path</span> <span class="o">=</span> <span class="n">tmp_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;out.csv&#39;</span><span class="p">)</span>
    <span class="n">seasons</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="n">DATA</span><span class="p">,</span> <span class="n">out_path</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">out_path</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">()</span> <span class="o">==</span> <span class="n">CSV_BYTES</span>
</code></pre></div>

<h3 id="the-path-might-not-be-valid">The path might not be valid<span class="headerlink"> <a href="#the-path-might-not-be-valid" title="permalink">#</a></span></h3>
<p>But, what if you pass a directory as the path?</p>
<div class="highlight code-container"><pre class="code" data-lang="Bash Session"><span></span><code><span class="gp">$ </span><span class="nb">time</span><span class="w"> </span>python<span class="w"> </span>seasons.py<span class="w"> </span>--path<span class="w"> </span>.
<span class="go">Traceback (most recent call last):</span>
<span class="go">  ...</span>
<span class="go">IsADirectoryError: [Errno 21] Is a directory: &#39;.&#39;</span>
<span class="go">python seasons.py --path .  0.07s user 0.02s system 4% cpu 2.104 total</span>
</code></pre></div>
<p>OK, it fails with a traceback.
Worse, we waited for the API calls
only to throw the output away.
Thankfully, Click has fancy <a href="https://click.palletsprojects.com/en/latest/parameters/#parameter-types">parameter types</a> that can take care of that:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--path&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dir_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">writable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</code></pre></div>

<div class="highlight code-container"><pre class="code" data-lang="Bash Session"><span></span><code><span class="gp">$ </span><span class="nb">time</span><span class="w"> </span>python<span class="w"> </span>seasons.py<span class="w"> </span>--path<span class="w"> </span>.
<span class="go">Usage: seasons.py [OPTIONS]</span>
<span class="go">Try &#39;seasons.py --help&#39; for help.</span>

<span class="go">Error: Invalid value for &#39;--path&#39;: File &#39;.&#39; is a directory.</span>
<span class="go">python seasons.py --path .  0.08s user 0.02s system 92% cpu 0.112 total</span>
</code></pre></div>
<p>Not only do we get a nice error message,
we get it instantly!</p>
<h3 id="the-path-to-what-exactly">The path to what, exactly?<span class="headerlink"> <a href="#the-path-to-what-exactly" title="permalink">#</a></span></h3>
<p>Thing is, <code>--path</code> isn't very descriptive.
I wonder if there's a better name for it...</p>
<p>One thing I like to do is to look at what others are doing.</p>
<div class="highlight code-container"><pre class="code" data-lang="Bash Session"><span></span><code><span class="gp">$ </span>curl<span class="w"> </span>--help
<span class="go">Usage: curl [options...] &lt;url&gt;</span>
<span class="go"> -o, --output &lt;file&gt; Write to file instead of stdout</span>
<span class="go"> -O, --remote-name   Write output to a file named as the remote file</span>
<span class="go"> ...</span>
</code></pre></div>
<div class="highlight code-container"><pre class="code" data-lang="Bash Session"><span></span><code><span class="gp">$ </span>wget<span class="w"> </span>--help
<span class="go">GNU Wget 1.21.2, a non-interactive network retriever.</span>
<span class="go">Usage: wget [OPTION]... [URL]...</span>
<span class="go">  -o,  --output-file=FILE          log messages to FILE</span>
<span class="go">  -O,  --output-document=FILE      write documents to FILE</span>
</code></pre></div>
<div class="highlight code-container"><pre class="code" data-lang="Bash Session"><span></span><code><span class="gp">$ </span>sort<span class="w"> </span>--help
<span class="go">Usage: sort [OPTION]... [FILE]...</span>
<span class="go">  -o, --output=FILE         write result to FILE instead of standard output</span>
</code></pre></div>
<div class="highlight code-container"><pre class="code" data-lang="Bash Session"><span></span><code><span class="gp">$ </span>pandoc<span class="w"> </span>--help
<span class="go">pandoc [OPTIONS] [FILES]</span>
<span class="go">  -o FILE               --output=FILE</span>
</code></pre></div>
<p>Better yet, sometimes there's a comprehensive guide on a topic,
like <a href="https://clig.dev/">Command Line Interface Guidelines</a>
...and under <a href="https://clig.dev/#arguments-and-flags">Arguments and flags</a>,
we find this:</p>
<blockquote>
<p><strong>Use standard names for flags, if there is a standard.</strong> If another commonly used command uses a flag name, it’s best to follow that existing pattern. That way, a user doesn’t have to remember two different options (and which command it applies to), and users can even guess an option without having to look at the help text.</p>
<p>Here’s a list of commonly used options: [...]</p>
<ul>
<li><code>-o</code>, <code>--output</code>: Output file. For example, <code>sort</code>, <code>gcc</code>.</li>
</ul>
</blockquote>
<h3 id="standard-output">Standard output<span class="headerlink"> <a href="#standard-output" title="permalink">#</a></span></h3>
<p>Further down below, there's another guideline:</p>
<blockquote>
<p><strong>If input or output is a file, support <code>-</code> to read from <code>stdin</code> or write to <code>stdout</code>.</strong> This lets the output of another command be the input of your command and vice versa, without using a temporary file. [...]</p>
</blockquote>
<p>I wonder how we could achieve this.</p>
<p>One way would be to check the value and use <a href="https://docs.python.org/3/library/sys.html#sys.stdout">sys.stdout</a> if it's <code>-</code>.</p>
<p>But let's pause and look at the <a href="https://click.palletsprojects.com/en/latest/api/#click.Path">Path</a> docs a bit:</p>
<blockquote>
<p>allow_dash (bool) – Allow a single dash as a value, which indicates a standard stream (but does not open it). Use <a href="https://click.palletsprojects.com/en/latest/api/#click.open_file">open_file()</a> to handle opening this value.</p>
</blockquote>
<p>Encouraging; following along, <a href="https://click.palletsprojects.com/en/latest/api/#click.open_file">open_file()</a> says:</p>
<blockquote>
<p>Open a file, with extra behavior to handle <code>'-'</code> to indicate a standard stream, lazy open on write, and atomic write. Similar to the behavior of the <a href="https://click.palletsprojects.com/en/latest/api/#click.File">File</a> param type.</p>
</blockquote>
<p>What's this File, eh?</p>
<blockquote>
<p>Declares a parameter to be a file for reading or writing. [...] The special value <code>-</code> indicates stdin or stdout depending on the mode. [...]</p>
<p>See <a href="https://click.palletsprojects.com/en/latest/arguments/#file-args">File Arguments</a> for more information.</p>
</blockquote>
<p>Which finally takes us away from the API reference to the actual <em>documentation</em>:<sup class="footnote-ref" id="fnref-2"><a href="#fn-2">2</a></sup></p>
<blockquote>
<p>Since all the examples have already worked with filenames, it makes sense to explain how to deal with files properly. Command line tools are more fun if they work with files the Unix way, which is to accept <code>-</code> as a special file that refers to stdin/stdout.</p>
<p>Click supports this through the <a href="https://click.palletsprojects.com/en/latest/api/#click.File">click.File</a> type which intelligently handles files for you. [...]</p>
</blockquote>
<p>OK, OK, I get it, let's use it:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;--output&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the names of the Discordian seasons.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">()</span>
    <span class="c1"># click.File doesn&#39;t have a newline argument</span>
    <span class="n">output</span><span class="o">.</span><span class="n">reconfigure</span><span class="p">(</span><span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">write_csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</code></pre></div>

<p>With passing a file object to <code>write_csv()</code>,
the <em>output</em> part of I/O is also decoupled:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="k">def</span> <span class="nf">write_csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;short_name&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;short_name&#39;</span><span class="p">]])</span>
</code></pre></div>

<p>(Interestingly enough, <a href="https://docs.python.org/3/library/csv.html#csv.writer">csv.writer</a> <em>already</em> takes an open file.)</p>
<p>Anyway, it works:</p>
<div class="highlight code-container"><pre class="code" data-lang="Bash Session"><span></span><code><span class="gp">$ </span>python<span class="w"> </span>seasons.py<span class="w"> </span>--output<span class="w"> </span>-
<span class="go">name,short_name</span>
<span class="go">Chaos,Chs</span>
<span class="go">Discord,Dsc</span>
<span class="go">Confusion,Cfn</span>
<span class="go">Bureaucracy,Bcy</span>
<span class="go">The Aftermath,Afm</span>
</code></pre></div>
<p>Once again, the test gets simpler too –
instead of writing anything to disk,
we can use an <a href="https://docs.python.org/3/library/io.html#io.BytesIO">in-memory stream</a>:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="k">def</span> <span class="nf">test_write_csv</span><span class="p">():</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">seasons</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="n">DATA</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">file</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">==</span> <span class="n">CSV_BYTES</span>
</code></pre></div>

<h3 id="by-default">... by default<span class="headerlink"> <a href="#by-default" title="permalink">#</a></span></h3>
<p>Some of the help texts <a href="#the-path-to-what-exactly">we looked at</a>
say &quot;write to FILE instead of stdout&quot;...</p>
<p>Why <em>instead?</em></p>
<p>Using commands in a pipeline is common enough that
most Unix commands write to stdout <em>by default</em>;
some don't even bother with an <code>--output</code> option,
since you can always redirect stdout to a file:</p>
<div class="highlight code-container"><pre class="code" data-lang="Bash Session"><span></span><code><span class="gp">$ </span>tail<span class="w"> </span>-n+2<span class="w"> </span>calendar.csv<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n2
<span class="go">Chaos,Chs</span>
<span class="go">Discord,Dsc</span>
<span class="gp">$ </span>tail<span class="w"> </span>-n+2<span class="w"> </span>calendar.csv<span class="w"> </span>&gt;<span class="w"> </span>calendar-no-heading.csv
<span class="gp">$ </span>head<span class="w"> </span>-n2<span class="w"> </span>calendar-no-heading.csv
<span class="go">Chaos,Chs</span>
<span class="go">Discord,Dsc</span>
</code></pre></div>
<p>Indeed, it is so common that <a href="https://clig.dev/">CLI Guidelines</a>
makes it the third thing in <a href="https://clig.dev/#the-basics">The Basics</a>:</p>
<blockquote>
<p><strong>Send output to <code>stdout</code>.</strong> The primary output for your command should go to <code>stdout</code>. Anything that is machine readable should also go to <code>stdout</code>—this is where piping sends things by default.</p>
</blockquote>
<p>We could remove <code>--output</code>, but with Click, doing both is trivially easy:</p>
<div class="highlight code-container"><pre class="code" data-lang="Python"><span></span><code><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;--output&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight code-container"><pre class="code" data-lang="Bash Session"><span></span><code><span class="gp">$ </span>python<span class="w"> </span>seasons.py<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n+2<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n2
<span class="go">Chaos,Chs</span>
<span class="go">Discord,Dsc</span>
</code></pre></div>
<h3 id="discussion">Discussion<span class="headerlink"> <a href="#discussion" title="permalink">#</a></span></h3>
<p>Looking at our journey, I can't help but notice a few things:</p>
<ul>
<li>The Click <a href="https://click.palletsprojects.com/en/latest/api/">API reference</a> seems to constantly funnel readers
to the <a href="https://click.palletsprojects.com/en/latest/#documentation">user guide</a> part of the documentation,
the part that tells you <em>how</em> and <em>why</em> to use stuff.</li>
<li>Click mentions supporting <code>-</code> for stdout, and more than once.</li>
<li>The Click user guide discusses <a href="https://click.palletsprojects.com/en/latest/api/#click.File">File</a> arguments <em>before</em> <a href="https://click.palletsprojects.com/en/latest/api/#click.Path">Path</a>
(in part, because it's more commonly used,
but also because it's more useful out of the box).</li>
<li><a href="https://docs.python.org/3/library/csv.html#csv.writer">csv.writer</a> takes an open file,
just like our own <code>write_csv()</code> does at the end.</li>
</ul>
<p>These all hint that it may be a good idea to structure code a certain way;
the more we use things the way they &quot;want&quot; to be used,
the cleaner the code and the tests get.</p>
<h2 id="good-libraries-educate">Good libraries educate<span class="headerlink"> <a href="#good-libraries-educate" title="permalink">#</a></span></h2>
<p>I am tempted to call <a href="https://click.palletsprojects.com/">Click</a> a <em>great library</em>.</p>
<p>Yes, it does its job more than well, and has lots of features.</p>
<p>But, more importantly, its documentation
educates the reader about the subject matter
– it goes beyond API docs into how to use it,
how to get specific things done with it,
and the underlying problem it is solving.</p>
<p>Here are a few more examples:</p>
<ul>
<li>Classics – other libraries in the <a href="https://flask.palletsprojects.com">Flask</a>/Pallets ecosystem
(like <a href="https://werkzeug.palletsprojects.com">Werkzeug</a> and <a href="https://jinja.palletsprojects.com">Jinja</a>), <a href="https://requests.readthedocs.io">Requests</a>, <a href="https://docs.pytest.org">pytest</a>, and many others –
popular <em>and</em> old enough libraries usually have great documentation.</li>
<li>Python itself – you would be amazed at how many developers
use Python every day without having gone through <a href="https://docs.python.org/3/tutorial/">the tutorial</a> even once.</li>
<li><a href="https://feedparser.readthedocs.io">feedparser</a> teaches you about
<a href="https://feedparser.readthedocs.io/en/latest/advanced.html">all kinds of Atom and RSS quirks</a>,
<a href="https://feedparser.readthedocs.io/en/latest/character-encoding.html">encodings on the web</a>,
<a href="https://feedparser.readthedocs.io/en/latest/http.html">HTTP</a>,
and how to be nice to servers you're making requests to.<ul>
<li>feedparser is close to my heart because I'm using it
for my feed reader library, <a href="https://reader.readthedocs.io/">reader</a>,
where I too am doing my best to have <a href="https://reader.readthedocs.io/en/latest/guide.html">docs worth reading</a>.</li>
</ul>
</li>
<li>Stepping away from Python a bit,
I've learned a lot from both <a href="https://dagger.dev/dev-guide/">Dagger</a> and <a href="https://site.mockito.org/">Mockito</a>
(and for the latter, the API docs for the
<a href="https://javadoc.io/doc/org.mockito/mockito-core/latest/org/mockito/Mockito.html">&quot;main&quot; class</a>
pack way more than just API,
and that <em>will</em> show up in your IDE).</li>
<li><a href="https://beancount.github.io/docs/">Beancount</a>, a command-line accounting tool,
does a great job of teaching double-entry bookkeeping
(indeed, it taught me almost all I know about the topic).</li>
</ul>
<h2 id="read-the-docs">Read the docs<span class="headerlink"> <a href="#read-the-docs" title="permalink">#</a></span></h2>
<p>In a way, this whole article is a ruse to tell you to <a href="https://en.wikipedia.org/wiki/RTFM">RTFM</a>,
but with a bit of nuance.</p>
<p>Read the documentation to find out <em>how</em>,
and more importantly, <em>why</em> –
a proper mental model of the thing you're using
will make you more productive,
and will improve any guesses you do make.</p>
<p>Aside from the user guide part,
I also like to skim the entire reference for libraries I use a lot;
this gives me an idea of what's available,
and often I remember later that
&quot;hey, there was something in the docs about X&quot;.</p>
<h3 id="but-the-docs-suck">But the docs suck<span class="headerlink"> <a href="#but-the-docs-suck" title="permalink">#</a></span></h3>
<p>Sometimes, documentation sucks or is missing altogether
(and doubly so for internal code bases).
It's easy to get used to not bother looking
when most of the time they're not there.</p>
<p>Nevertheless, give it a try?
You won't know until you look,
and worst case, you'll have wasted a minute.</p>
<p>On the other hand, documentation should be one of the criteria when picking a library.</p>
<h3 id="but-i-m-using-lots-of-libraries">But I'm using lots of libraries<span class="headerlink"> <a href="#but-i-m-using-lots-of-libraries" title="permalink">#</a></span></h3>
<p>Quoting a friend of mine:</p>
<blockquote>
<p>Well, for you, it might be &quot;a library&quot;,
but for them it's 10 new libraries,
and a 2-day deadline.</p>
</blockquote>
<p>This can be the case, and often is.</p>
<p>Nevertheless, for the ones you use often
(stdlib, test framework, web framework),
going through the docs once has a huge return on investment,
and starts paying out quite quickly.</p>
<p>(TODO: reword the above)</p>
<h2 id="conclusion">Conclusion<span class="headerlink"> <a href="#conclusion" title="permalink">#</a></span></h2>
<p>TODO: reword / clean up / expand</p>
<p>So:</p>
<ul>
<li>Good libraries educate on subject matter.</li>
<li>Read the documentation of the things you are using; look at the examples, skim reference at least once (helps you know what's available, you might remember &quot;hey, there was some thing in the docs about this&quot;)<ul>
<li>Sometimes (maybe even a lot of time), the docs are poor, but you won't know until you read them</li>
<li>Sometimes, you're using lots of libraries. Nevertheless, for the ones you use often, going through the docs once has a huge return on investment, and pays out quite quickly</li>
</ul>
</li>
<li>If you feel you are fighting your tools, maybe you are using them wrong (read the docs!), Or maybe you should find better tools</li>
</ul>
<section class="footnotes">
<ol>
<li id="fn-1"><p>For a detailed example about decoupling I/O,
how it affects affects testing,
plus interesting historical background,
check out Brandon Rhodes' <em>great</em> talk
<a href="https://rhodesmill.org/brandon/talks/#clean-architecture-python">The Clean Architecture in Python</a>. <a href="#fnref-1" class="footnote"><sup>[return]</sup></a></p></li>
<li id="fn-2"><p>Is it not written, &quot;A few hours of trial and error can save you five minutes of reading the docs&quot;? <a href="#fnref-2" class="footnote"><sup>[return]</sup></a></p></li>
</ol>
</section>








</div>
</main>


<footer class="footer">
<p class="text-gray">
<a href="/">home</a>
∙ <a href="/_feed/index.xml">feed</a>
∙ <a href="/about">about</a>

∙ © 2021 lemon24



</footer>


</div>