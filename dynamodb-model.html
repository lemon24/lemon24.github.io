












<!doctype html>

<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" href="/_static/spectre.css">
<link rel="stylesheet" href="/_static/pygments.css">
<link rel="stylesheet" href="/_static/style.css">

<link rel="alternate" type="application/atom+xml" title="Atom feed" href="/_feed/index.xml" />

<link rel="icon" href="/_static/xo-system-icon.svg">
<link rel="apple-touch-icon" href="/_static/xo-system-icon.svg">







<title>DynamoDB crash course: part 2 – data model - death and gravity</title>



<meta property="og:title" content="DynamoDB crash course: part 2 – data model">
<meta property="og:site_name" content="death and gravity">
<meta property="og:type" content="article">
<meta property="og:url" content="https://death.andgravity.com/dynamodb-model">




<script>
/* https://css-tricks.com/the-trick-to-viewport-units-on-mobile/ */
function set_vh() {
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
}
/* we do it once, now, *and* on every resize */
set_vh();
window.addEventListener('resize', set_vh);
</script>





<div class="main container grid-lg">


<header>
<nav>
<ul class="breadcrumb">

<li class="breadcrumb-item">
    <a href="/">death and gravity</a>
</li>

</ul>
</nav>

<h1 class="heading-noindex">DynamoDB crash course: part 2 – data model</h1>

<p class="text-gray text-nowrap">



<small>
<span class="tooltip" data-tooltip="published on 2025-12-19">December 2025</span>
∙ 11 minute read
∙
</small><span class="share-icons">
<a
    class="share-icon pycoders"
    href="https://pycoders.com/submissions"
    target="_blank"
>PyCoder's Weekly</a>
<a
    class="share-icon hacker-news"
    href="https://news.ycombinator.%63%6f%6d/submitlink?u=https%3A//death.andgravity.com/dynamodb-model&t=DynamoDB%20crash%20course%3A%20part%202%20%E2%80%93%20data%20model"
>HN</a>
<a
    class="share-icon bluesky"
    href="https://bsky.%61%70%70/intent/compose?text=DynamoDB%20crash%20course%3A%20part%202%20%E2%80%93%20data%20model%20https%3A//death.andgravity.com/dynamodb-model"
>Bluesky</a>
<!--
<a
    class="share-icon reddit"
    href="https://www.reddit.%63%6f%6d/%73%75%62%6d%69%74?url=https%3A//death.andgravity.com/dynamodb-model&title=DynamoDB%20crash%20course%3A%20part%202%20%E2%80%93%20data%20model"
>Reddit</a>
-->
<a
    class="share-icon linkedin"
    href="https://www.linkedin.%63%6f%6d/sharing/share-offsite/?url=https%3A//death.andgravity.com/dynamodb-model"
>linkedin</a>
<a
    class="share-icon twitter"
    href="https://twitter.%63%6f%6d/%73%68%61%72%65?text=DynamoDB%20crash%20course%3A%20part%202%20%E2%80%93%20data%20model&url=https%3A//death.andgravity.com/dynamodb-model&via=_andgravity"
>Twitter</a>
</span>


</p>






</header>


<main class="content columns">
<div class="column col-sm-12 col-md-10 col-8">

<details class="toc" open>
<summary>Table of Contents</summary>
<ul>
<li><a href="#core-components">Core components</a>
<ul>
<li><a href="#tables">Tables</a></li>
<li><a href="#partitions">Partitions</a></li>
<li><a href="#items">Items</a></li>
<li><a href="#attributes">Attributes</a></li>
</ul>
</li>
<li><a href="#operations">Operations</a></li>
<li><a href="#limits">Limits</a>
<ul>
<li><a href="#partition-throughput">Partition throughput</a></li>
<li><a href="#item-size">Item size</a></li>
<li><a href="#page-size">Page size</a></li>
</ul>
</li>
<li><a href="#indexes">Indexes</a>
<ul>
<li><a href="#global-secondary-indexes">Global secondary indexes</a></li>
<li><a href="#local-secondary-indexes">Local secondary indexes</a></li>
</ul>
</li>
<li><a href="#features">Features</a>
<ul>
<li><a href="#eventual-consistency">Eventual consistency</a></li>
<li><a href="#conditional-updates">Conditional updates</a></li>
<li><a href="#transactions">Transactions</a></li>
<li><a href="#batch-operations">Batch operations</a></li>
<li><a href="#streams">Streams</a></li>
</ul>
</li>
</ul>
</details>
<h2 id="core-components">Core components<span class="headerlink">&nbsp;<a href="#core-components" title="permalink">#</a></span></h2>
<!--
All statements are true in some sense,
false in some sense,
meaningless in some sense,
true and false in some sense,
true and meaningless in some sense,
false and meaningless in some sense,
and true and false and meaningless in some sense.
-->

<p>According to the official <a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.CoreComponents.html">documentation</a>,
the &quot;core components that you work with&quot; are
<strong>tables</strong>, <strong>items</strong>, and <strong>attributes</strong>.
In the sense of <em>what you can act on through the API</em>,
this is accurate. Let's call this the <em>logical model</em>.</p>
<p>However, there's another important sense, <!-- half of the docs is about it-->
that of <em>how your application scales</em>.
We can call it the <em>physical model</em> by analogy,
but we should be clear that
it is physical only in the highest level of ways <!-- most abstract[ed] way -->
–
DynamoDB takes the complexity of real computers with real limits
and packages it into a single inconvenient abstraction:
the <strong>partition</strong>.</p>
<p>Let's put it all together, starting from the top.</p>
<!--
*A **table** is a hash table of partitions,<br>
a **partition** is a B-tree of items, and<br>
an **item** is a hash table of attributes.*
-->

<figure class="figure">

<svg xmlns='http://www.w3.org/2000/svg' style='font-size:initial;' class="pikchr" viewBox="0 0 476.64 313.498" data-pikchr-date="20260102012653">
<path d="M3.6,275.76L473.04,275.76A1.44 1.44 0 0 0 474.48 274.32L474.48,3.6A1.44 1.44 0 0 0 473.04 2.16L3.6,2.16A1.44 1.44 0 0 0 2.16 3.6L2.16,274.32A1.44 1.44 0 0 0 3.6 275.76Z"  style="fill:rgb(230,230,250);stroke-width:2.16;stroke:rgb(102,51,153);" />
<path d="M18,261.36L308.88,261.36A1.44 1.44 0 0 0 310.32 259.92L310.32,68.4A1.44 1.44 0 0 0 308.88 66.96L18,66.96A1.44 1.44 0 0 0 16.56 68.4L16.56,259.92A1.44 1.44 0 0 0 18 261.36Z"  style="fill:rgb(255,228,225);stroke-width:2.16;stroke:rgb(255,0,0);stroke-dasharray:7.2,7.2;" />
<path d="M32.4,246.96L144.72,246.96A1.44 1.44 0 0 0 146.16 245.52L146.16,133.2A1.44 1.44 0 0 0 144.72 131.76L32.4,131.76A1.44 1.44 0 0 0 30.96 133.2L30.96,245.52A1.44 1.44 0 0 0 32.4 246.96Z"  style="fill:rgb(230,230,250);stroke-width:2.16;stroke:rgb(102,51,153);" />
<path d="M46.8,189.36L130.32,189.36A1.44 1.44 0 0 0 131.76 187.92L131.76,169.2A1.44 1.44 0 0 0 130.32 167.76L46.8,167.76A1.44 1.44 0 0 0 45.36 169.2L45.36,187.92A1.44 1.44 0 0 0 46.8 189.36Z"  style="fill:rgb(255,255,255);stroke-width:1.4472;stroke:rgb(30,144,255);" />
<text x="88.56" y="178.56" text-anchor="middle" fill="rgb(30,144,255)" font-size="80%" dominant-baseline="central">attribute</text>
<path d="M46.8,210.96L130.32,210.96A1.44 1.44 0 0 0 131.76 209.52L131.76,190.8A1.44 1.44 0 0 0 130.32 189.36L46.8,189.36A1.44 1.44 0 0 0 45.36 190.8L45.36,209.52A1.44 1.44 0 0 0 46.8 210.96Z"  style="fill:rgb(255,255,255);stroke-width:1.4472;stroke:rgb(30,144,255);" />
<text x="88.56" y="200.16" text-anchor="middle" fill="rgb(30,144,255)" font-size="80%" dominant-baseline="central">attribute</text>
<text x="88.56" y="221.76" text-anchor="middle" font-weight="bold" fill="rgb(30,144,255)" dominant-baseline="central">...</text>
<text x="36.72" y="146.88" text-anchor="start" font-weight="bold" fill="rgb(102,51,153)" dominant-baseline="central">item</text>
<path d="M162,246.96L245.52,246.96A1.44 1.44 0 0 0 246.96 245.52L246.96,133.2A1.44 1.44 0 0 0 245.52 131.76L162,131.76A1.44 1.44 0 0 0 160.56 133.2L160.56,245.52A1.44 1.44 0 0 0 162 246.96Z"  style="fill:rgb(230,230,250);stroke-width:2.16;stroke:rgb(102,51,153);" />
<text x="203.76" y="189.36" text-anchor="middle" font-weight="bold" fill="rgb(102,51,153)" dominant-baseline="central">···</text>
<text x="166.32" y="146.88" text-anchor="start" font-weight="bold" fill="rgb(102,51,153)" dominant-baseline="central">item</text>
<text x="278.64" y="189.36" text-anchor="middle" font-weight="bold" fill="rgb(102,51,153)" dominant-baseline="central">···</text>
<text x="22.32" y="82.08" text-anchor="start" font-weight="bold" fill="rgb(255,0,0)" dominant-baseline="central">partition (B-tree)</text>
<path d="M326.16,261.36L409.68,261.36A1.44 1.44 0 0 0 411.12 259.92L411.12,68.4A1.44 1.44 0 0 0 409.68 66.96L326.16,66.96A1.44 1.44 0 0 0 324.72 68.4L324.72,259.92A1.44 1.44 0 0 0 326.16 261.36Z"  style="fill:rgb(255,228,225);stroke-width:2.16;stroke:rgb(255,0,0);stroke-dasharray:7.2,7.2;" />
<text x="367.92" y="164.16" text-anchor="middle" font-weight="bold" fill="rgb(255,0,0)" dominant-baseline="central">···</text>
<text x="330.48" y="82.08" text-anchor="start" font-weight="bold" fill="rgb(255,0,0)" dominant-baseline="central">partition</text>
<text x="442.8" y="164.16" text-anchor="middle" font-weight="bold" fill="rgb(255,0,0)" dominant-baseline="central">···</text>
<text x="7.92" y="17.28" text-anchor="start" font-weight="bold" fill="rgb(102,51,153)" dominant-baseline="central">table (hash table)</text>
<polygon points="203.76,131.76 200.866,124.042 206.654,124.042" style="fill:rgb(255,0,0)"/>
<path d="M203.76,127.901L203.76,117.36"  style="fill:none;stroke-width:1.4472;stroke:rgb(255,0,0);" />
<text x="203.76" y="106.56" text-anchor="middle" fill="rgb(255,0,0)" font-size="80%" dominant-baseline="central">sort key</text>
<polygon points="88.56,131.76 85.6656,124.042 91.4544,124.042" style="fill:rgb(255,0,0)"/>
<path d="M88.56,127.901L88.56,117.36"  style="fill:none;stroke-width:1.4472;stroke:rgb(255,0,0);" />
<text x="88.56" y="106.56" text-anchor="middle" fill="rgb(255,0,0)" font-size="80%" dominant-baseline="central">sort key</text>
<polygon points="163.44,66.96 160.546,59.2416 166.334,59.2416" style="fill:rgb(255,0,0)"/>
<path d="M163.44,63.1008L163.44,52.56"  style="fill:none;stroke-width:1.4472;stroke:rgb(255,0,0);" />
<text x="163.44" y="41.76" text-anchor="middle" fill="rgb(255,0,0)" font-size="80%" dominant-baseline="central">partition key</text>
<polygon points="367.92,66.96 365.026,59.2416 370.814,59.2416" style="fill:rgb(255,0,0)"/>
<path d="M367.92,63.1008L367.92,52.56"  style="fill:none;stroke-width:1.4472;stroke:rgb(255,0,0);" />
<text x="367.92" y="41.76" text-anchor="middle" fill="rgb(255,0,0)" font-size="80%" dominant-baseline="central">partition key</text>
<path d="M4.02177,311.338L130.742,311.338A1.44 1.44 0 0 0 132.182 309.898L132.182,291.178A1.44 1.44 0 0 0 130.742 289.738L4.02177,289.738A1.44 1.44 0 0 0 2.58177 291.178L2.58177,309.898A1.44 1.44 0 0 0 4.02177 311.338Z"  style="fill:rgb(230,230,250);stroke-width:2.16;stroke:rgb(102,51,153);" />
<text x="67.3818" y="300.538" text-anchor="middle" fill="rgb(102,51,153)" font-size="64%" dominant-baseline="central">physical and logical</text>
<path d="M140.822,311.338L267.542,311.338A1.44 1.44 0 0 0 268.982 309.898L268.982,291.178A1.44 1.44 0 0 0 267.542 289.738L140.822,289.738A1.44 1.44 0 0 0 139.382 291.178L139.382,309.898A1.44 1.44 0 0 0 140.822 311.338Z"  style="fill:rgb(255,228,225);stroke-width:2.16;stroke:rgb(255,0,0);stroke-dasharray:7.2,7.2;" />
<text x="204.182" y="300.538" text-anchor="middle" fill="rgb(255,0,0)" font-size="64%" dominant-baseline="central">physical only</text>
<path d="M277.622,311.338L404.342,311.338A1.44 1.44 0 0 0 405.782 309.898L405.782,291.178A1.44 1.44 0 0 0 404.342 289.738L277.622,289.738A1.44 1.44 0 0 0 276.182 291.178L276.182,309.898A1.44 1.44 0 0 0 277.622 311.338Z"  style="fill:rgb(255,255,255);stroke-width:1.4472;stroke:rgb(30,144,255);" />
<text x="340.982" y="300.538" text-anchor="middle" fill="rgb(30,144,255)" font-size="64%" dominant-baseline="central">logical only</text>
<text x="147.898" y="182.909" text-anchor="middle" fill="rgb(230,230,250)" font-size="64%" transform="rotate(90 147.898,189.36)" dominant-baseline="central">death.andgravity.com</text>
</svg>


</figure>

<h3 id="tables">Tables<span class="headerlink">&nbsp;<a href="#tables" title="permalink">#</a></span></h3>
<p>In the logical model, a table is a collection of items.
Additionally, tables serve as container for various configurations
like the primary key schema, indexes, provisioned capacity, permissions and so on.</p>
<p>In the physical model, a table is a hash table of partitions,
where hash table keys are partition keys.
There are no limits on how many partitions a table can have or what size it can be.</p>
<p>Depending on how you structure your data,
A DynamoDB table can correspond to either a single table or a whole database
in a relational database system.</p>
<h3 id="partitions">Partitions<span class="headerlink">&nbsp;<a href="#partitions" title="permalink">#</a></span></h3>
<p>In the logical model, partitions do not exist
– you can't create them, delete them, or list them.
The only way they leak through is that items have to have a primary key.</p>
<p>In the physical model, a partition is a B-tree of items,
where B-tree keys are sort keys.
A partition is uniquely identified within a table by its partition key.
There are no limits on how many items a partition can have or what size it can be,
but there is a limit on throughput (aka capacity):
how much data you can read or write from the partition in a given time.</p>
<p>Partitions are where the scaling magic happens.
DynamoDB manages partitions behind the scenes,
ensuring load is spread evenly across computers <!-- reword -->
–
depending on size and throughput,
multiple partitions may be placed on the same computer,
or a single partition may be split across multiple computers,
a contiguous range of sort keys on each.
This is entirely transparent to you as a user.</p>
<p>Partitions are somewhat analogous to <a class="external" href="https://en.wikipedia.org/wiki/Shard_(database_architecture)">shards</a>,
but unlike with most relational databases,
partitions are built <em>into</em> the database,
rather than <em>on top</em> of it.</p>
<h3 id="items">Items<span class="headerlink">&nbsp;<a href="#items" title="permalink">#</a></span></h3>
<p>In the logical model, an item is a collection of attributes.
An item is uniquely identified within a table by two of its attributes
called its primary key. <!-- rewrite to mention part/sort --></p>
<p>In the physical model, an item is
<strong>the smallest unit of data that you can read or write</strong>
–
while the API allows more granular operations,
the capacity consumed is always that of the entire item.
An item is uniquely identified within a partition by its sort key.<sup class="footnote-ref" id="fnref-1"><a href="#fn-1">1</a></sup>
Items have a size limit of 400 KB per item.</p>
<p>A DynamoDB item usually corresponds to a row in a relational database system.</p>
<!-- see also https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/read-write-operations.html -->

<!-- see also item size / or mention we'll look them at later -->

<h3 id="attributes">Attributes<span class="headerlink">&nbsp;<a href="#attributes" title="permalink">#</a></span></h3>
<p>An attribute is
&quot;a fundamental data element,
something that does not need to be broken down any further&quot;.
The value of an attribute can be
a scalar (string, number, etc.),
a set of scalars,
or a document (a list or map of other values, possibly nested).</p>
<p>In the logical model,
the attribute <a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DocumentHistory.html#:~:text=Document%20model%20support%20with%20JSON">used to be</a>
the smallest unit of data you could get,
although nowadays you can access nested attributes using <a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Expressions.ProjectionExpressions.html">projection expressions</a>
(note that this only saves bandwidth,
you always pay the capacity for the entire item).</p>
<p>In the physical model,
partition and sort keys <em>are</em> attributes;
since indexes have keys of their own,
attributes are also what you index on.
Attributes can be any size, within the item size limit;
partition and sort keys are further limited
to 2 and 1 KiB, respectively.</p>
<p>A DynamoDB attribute corresponds to a field in a relational database system.</p>
<!-- see also https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.NamingRulesDataTypes.html -->

<h2 id="operations">Operations<span class="headerlink">&nbsp;<a href="#operations" title="permalink">#</a></span></h2>
<p>TODO: while API operates on itesms, if you squint only ht of bt ops are allowed</p>
<p>Conceptually, a DynamoDB table is a <a class="external" href="https://en.wikipedia.org/wiki/Hash_table">hash table</a> of <a class="external" href="https://en.wikipedia.org/wiki/B-tree">B-trees</a>
(or any other kind of sorted data structure that allows
fast searches, sequential access, insertions, and deletions).</p>
<p>An item has two <em>hierarchical</em> keys that make up a composite <strong>primary key</strong>:</p>
<ul>
<li><strong>partition key</strong> (aka <strong>hash key</strong>);
this is the hash table key, and allows efficient
<em>get all items in partition</em> operations</li>
<li><strong>sort key</strong> (aka <strong>range key</strong>);
this is the B-tree key, and allows efficient
<em>get items in partition in a sort key range</em> operations,
including <em>get item by partition + sort key</em>;
the sort key is optional, but in most cases you will have one</li>
</ul>
<p>TODO: operations</p>
<p>Importantly,
<strong>any access not based on partition/sort key is expensive</strong>,
since it forces you to do a full table scan
(ignoring <a class="anchor" href="#indexes">indexes</a> for now),
and at the scales you'd use DynamoDB at,
this can mean going through billions of items.</p>
<section class="admonition note">
<p class="admonition-title">Example</p>
<p><small>(from <a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.CoreComponents.html#:~:text=another%20example%20table%20named%20Music">here</a>)</small>
Given a <em>Music</em> table where items correspond to songs,
with the <em>Artist</em> attribute as primary key
and <em>Song</em> as sort key,
you can efficiently:</p>
<ul>
<li>query songs by artist (sorted by song title)</li>
<li>get the song by artist and song title</li>
</ul>
<p>... and that's it, anything else requires a full table scan.</p>
<div class="highlight code-container"><pre class="code" data-lang="YAML"><span></span><code><span class="c1"># table Music (partition key: Artist, sort key: Song)</span>
<span class="nt">1000mods</span><span class="p">:</span><span class="w"> </span><span class="kt">!btree</span>
<span class="w">  </span><span class="nt">Claws</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Album</span><span class="p">:</span><span class="w"> </span><span class="nv">Vultures</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">Vidage</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Year</span><span class="p">:</span><span class="w"> </span><span class="nv">2011</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="nt">Kyuss</span><span class="p">:</span><span class="w"> </span><span class="kt">!btree</span>
<span class="w">  </span><span class="nt">Space Cadet</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="w"> </span><span class="p p-Indicator">}</span>
</code></pre></div>
</section>
<section class="admonition tip">
<p class="admonition-title">See also</p>
<ul>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.CoreComponents.html#HowItWorks.CoreComponents.PrimaryKey">Core components # Primary key</a></li>
<li><small>(unofficial)</small> <a class="external" href="https://www.alexdebrie.com/posts/dynamodb-partitions">Everything you need to know about DynamoDB Partitions</a></li>
</ul>
</section>
<h2 id="limits">Limits<span class="headerlink">&nbsp;<a href="#limits" title="permalink">#</a></span></h2>
<p>TODO: rephrase
The upside is that <strong>for supported dimensions,
DynamoDB scales infinitely</strong>[^infinitely] –
there are no limits on table size,
the number of items or partition keys in a table, or
the number of sort keys in a partition.</p>
<p>There are some important limits, though;
note these are hard, immutable limits, not adjustable quotas,
and as such you must design your application around them.</p>
<section class="admonition tip">
<p class="admonition-title">See also</p>
<ul>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/CheatSheet.html#CheatSheet.ServiceBasics">Cheat sheet # Service quota basics</a></li>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/ServiceQuotas.html">Quotas</a></li>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Constraints.html">Constraints</a></li>
<li><small>(unofficial)</small> <a class="external" href="https://www.alexdebrie.com/posts/dynamodb-limits/">The Three DynamoDB Limits You Need to Know</a></li>
</ul>
</section>
<p>TODO/IDEA: cheatsheet table a la big o cheatsheet
(one for table / partition / item )
(one for crud / batch / query/scan / transactions)</p>
<h3 id="partition-throughput">Partition throughput<span class="headerlink">&nbsp;<a href="#partition-throughput" title="permalink">#</a></span></h3>
<p>Most importantly, there is a per-partition throughput limit:</p>
<ul>
<li>for reads, there's a limit of 3,000 read capacity units per second;
this means 3,000 RCU / s * 4 KB / RCU = 12 MB/s
(eventually consistent reads are twice this)</li>
<li>for writes, there's a limit of 1,000 read capacity units per second;
this means 1,000 WCU / s * 1 KB / WCU = 1 MB/s</li>
</ul>
<p>Because of this, you have to be careful
to distribute requests evenly across partitions;
if there's no good natural partition key,
you can use techniques such as <a class="internal" href="/dynamodb-patterns#partition-key-sharding">sharding</a>.</p>
<!--
[400kb limit] which make items less important from a scaling point of view,
since it pushed the heavy lifting up to partitions.
!! not true
-->

<!-- call back to
In the physical model, an item is
**the smallest unit of data that you can read or write**
–
while the API allows more granular operations,
the capacity consumed is always that of the entire item.

also just counting
-->

<p>The amount of consumed capacity units is what you are billed for.<sup class="footnote-ref" id="fnref-2"><a href="#fn-2">2</a></sup>
While DynamoDB offers some server-side filtering capabilities
that are not shown in my Python mock-up above
(you can filter items based on expressions,
and you can &quot;select&quot; only specific attributes),
this only saves on network traffic and latency –
data read to evaluate expressions still counts as read,
and you will pay for it.
Because of this, optimizing your data access is not just a performance matter,
but a cost matter too.</p>
<!-- trade-off: small and busy partitions vs large and idle partitions -->

<section class="admonition tip">
<p class="admonition-title">See also</p>
<ul>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.Partitions.html">Partitions and data distribution</a></li>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/read-write-operations.html">Read and write operations</a> (capacity unit consumption)</li>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/bp-partition-key-design.html">Partition key design</a><ul>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/bp-partition-key-uniform-load.html">Distributing workloads</a></li>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/bp-partition-key-sharding.html">Write sharding</a></li>
</ul>
</li>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/bp-sort-keys.html">Sort key design</a></li>
<li><small>(blog)</small> <a class="external" href="https://aws.amazon.com/blogs/database/choosing-the-right-dynamodb-partition-key/">Choosing the Right DynamoDB Partition Key</a></li>
</ul>
</section>
<h3 id="item-size">Item size<span class="headerlink">&nbsp;<a href="#item-size" title="permalink">#</a></span></h3>
<p>Second, the maximum size of an item is 400 KB.
This can be worked around by either splitting an item into multiple ones
on the same partition,
or by storing only the metadata in DynamoDB,
with data somewhere else, like S3
(this is a pretty common pattern).</p>
<!-- fixed but generous for most use cases, -->

<section class="admonition tip">
<p class="admonition-title">See also</p>
<ul>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Constraints.html#limits-items">Constraints # Items</a></li>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/bp-use-s3-too.html">Large items</a></li>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/data-modeling-blocks.html#data-modeling-blocks-vertical-partitioning">Data modeling building blocks # Vertical partitioning building block</a></li>
</ul>
</section>
<h3 id="page-size">Page size<span class="headerlink">&nbsp;<a href="#page-size" title="permalink">#</a></span></h3>
<p>Finally, the result set of the query and scan operations
is limited to 1 MB per page,
but it is possible to stitch together multiple pages
by using a form of <a class="internal" href="/query-builder-why#intermission-scrolling-window-queries">keyset pagination</a>
(specifically, there's a <code>LastEvaluatedKey</code> that allows you to query/scan from the end of the previous page).</p>
<p>However, this has implications on consistency,
especially for secondary indexes –
if an attribute used in a <abbr title="Global Secondary Index">GSI</abbr> primary or sort key changes,
an item can appear zero or multiple times in the entire (multi-page) result set.</p>
<section class="admonition tip">
<p class="admonition-title">See also</p>
<ul>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Constraints.html#limits-api">Constraints # API-specific constraints</a></li>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Query.Pagination.html">Paginating query results</a></li>
</ul>
</section>
<h2 id="indexes">Indexes<span class="headerlink">&nbsp;<a href="#indexes" title="permalink">#</a></span></h2>
<p>When discussing tables,
I said that access not based on partition/sort key is expensive.
Secondary indexes allow other access patterns
by using an <strong>alternate primary key</strong>
composed of different attributes than that of the table.
You can query or scan an index just like you would a table.</p>
<section class="admonition tip">
<p class="admonition-title">See also</p>
<ul>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.CoreComponents.html#HowItWorks.CoreComponents.SecondaryIndexes">Core components # Secondary indexes</a></li>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/SecondaryIndexes.html">Working with indexes</a></li>
</ul>
</section>
<h3 id="global-secondary-indexes">Global secondary indexes<span class="headerlink">&nbsp;<a href="#global-secondary-indexes" title="permalink">#</a></span></h3>
<p>Conceptually, a global secondary index is a separate table
that's automatically kept in sync with the base table,
and allows having different attributes as primary key.</p>
<section class="admonition note">
<p class="admonition-title">Example</p>
<p><small>(from <a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.CoreComponents.html#:~:text=query%20the%20data%20by%20Genre%20and%20Album">here</a>)</small>
Continuing with the music example,
a <abbr title="Global Secondary Index">GSI</abbr> with <em>Genre</em> and <em>Album</em> as primary and sort key,
would allow you to <em>also</em> efficiently:</p>
<ul>
<li>query songs by genre
(and, if you collapse results in application code,
query albums by genre <em>somewhat</em> efficiently)</li>
<li>query songs by genre and album title
(but, two albums can have the same genre and title,
so you might want to group by artist in application code)</li>
</ul>
<div class="highlight code-container"><pre class="code" data-lang="YAML"><span></span><code><span class="c1"># table Music (partition key: Artist, sort key: Song)</span>
<span class="nt">Kyuss</span><span class="p">:</span><span class="w"> </span><span class="kt">!btree</span>
<span class="w">  </span><span class="nt">Demon Cleaner</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Album</span><span class="p">:</span><span class="w"> </span><span class="nv">Welcome To Sky Valley</span><span class="p p-Indicator">,</span><span class="nt"> Genre</span><span class="p">:</span><span class="w"> </span><span class="nv">Rock</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">Space Cadet</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Album</span><span class="p">:</span><span class="w"> </span><span class="nv">Welcome To Sky Valley</span><span class="p p-Indicator">,</span><span class="nt"> Genre</span><span class="p">:</span><span class="w"> </span><span class="nv">Rock</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="nt">1000mods</span><span class="p">:</span><span class="w"> </span><span class="kt">!btree</span>
<span class="w">  </span><span class="nt">Vidage</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Album</span><span class="p">:</span><span class="w"> </span><span class="nv">Super Van Vacation</span><span class="p p-Indicator">,</span><span class="nt"> Genre</span><span class="p">:</span><span class="w"> </span><span class="nv">Rock</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="nt">Solar Fields</span><span class="p">:</span><span class="w"> </span><span class="kt">!btree</span>
<span class="w">  </span><span class="nt">Air Song</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Album</span><span class="p">:</span><span class="w"> </span><span class="nv">Leaving Home</span><span class="p p-Indicator">,</span><span class="nt"> Genre</span><span class="p">:</span><span class="w"> </span><span class="nv">Electronic</span><span class="w"> </span><span class="p p-Indicator">}</span>
</code></pre></div>
<div class="highlight code-container"><pre class="code" data-lang="YAML"><span></span><code><span class="c1"># GSI Genres (partition key: Genre, sort key: Album)</span>
<span class="nt">Rock</span><span class="p">:</span><span class="w"> </span><span class="kt">!btree</span>
<span class="w">  </span><span class="nt">Super Van Vacation</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Artist</span><span class="p">:</span><span class="w"> </span><span class="nv">1000mods</span><span class="p p-Indicator">,</span><span class="nt"> Song</span><span class="p">:</span><span class="w"> </span><span class="nv">Vidage</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">Welcome To Sky Valley</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Artist</span><span class="p">:</span><span class="w"> </span><span class="nv">Kyuss</span><span class="p p-Indicator">,</span><span class="nt"> Song</span><span class="p">:</span><span class="w"> </span><span class="nv">Space Cadet</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">Welcome To Sky Valley</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Artist</span><span class="p">:</span><span class="w"> </span><span class="nv">Kyuss</span><span class="p p-Indicator">,</span><span class="nt"> Song</span><span class="p">:</span><span class="w"> </span><span class="nv">Demon Cleaner</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="nt">Electronic</span><span class="p">:</span><span class="w"> </span><span class="kt">!btree</span>
<span class="w">  </span><span class="nt">Leaving Home</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Artist</span><span class="p">:</span><span class="w"> </span><span class="nv">Solar Fields</span><span class="p p-Indicator">,</span><span class="nt"> Song</span><span class="p">:</span><span class="w"> </span><span class="nv">Air Song</span><span class="w"> </span><span class="p p-Indicator">}</span>
</code></pre></div>
</section>
<p>Aside from item partition and sort keys,
the index can include additional attributes,
so you can query the index alone;
this is called <strong><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/GSI.html#GSI.Projections">attribute projection</a></strong>,
and is analogous to a <a class="external" href="https://en.wikipedia.org/wiki/Database_index#Covering_index">covering index</a> in relational databases;
however,
if you need an attribute that's not in the index,
you'll have to get it yourself from the base table
(batch operations can make this faster). <!-- TODO link --></p>
<p>Unlike real tables,
<abbr title="Global Secondary Index">GSI</abbr>s support only eventually consistent reads,
and their primary keys do not need to be unique.
In all other respects,
<strong><abbr title="Global Secondary Index">GSI</abbr>s behave like real tables</strong>:</p>
<ul>
<li>they have their own <a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/GSI.html#GSI.ThroughputConsiderations">separate capacity</a></li>
<li>they have no limits on size or the number of primary keys</li>
<li>they have the same <a class="anchor" href="#partition-throughput">partition throughput</a> limits,
and the same workarounds <!-- TODO link to sharding --></li>
</ul>
<p>You can have up to 20 <abbr title="Global Secondary Index">GSI</abbr>s per table,
although in practice you can reuse them.</p>
<!-- TODO link to overloading -->

<p>TODO: discuss <abbr title="Global Secondary Index">GSI</abbr> write throttling</p>
<section class="admonition tip">
<p class="admonition-title">See also</p>
<ul>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/GSI.html">Global secondary indexes</a></li>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/bp-indexes.html">Best practices for secondary indexes</a></li>
</ul>
</section>
<h3 id="local-secondary-indexes">Local secondary indexes<span class="headerlink">&nbsp;<a href="#local-secondary-indexes" title="permalink">#</a></span></h3>
<p>A local secondary index allows you to have an <strong>alternate sort key</strong> for a partition
(it is <em>local</em> to the partition).</p>
<section class="admonition note">
<p class="admonition-title">Example</p>
<p>For the same <em>Music</em> with <em>Artist</em> as partition key,
a <abbr title="Local Secondary Index">LSI</abbr> with <em>Year</em> as sort key
would allow you to <em>also</em> efficiently:</p>
<ul>
<li>query songs by artist in chronological order</li>
<li>query songs by artist and year</li>
</ul>
<div class="highlight code-container"><pre class="code" data-lang="YAML"><span></span><code><span class="c1"># table Music (partition key: Artist, sort key: Song)</span>
<span class="nt">1000mods</span><span class="p">:</span><span class="w"> </span><span class="kt">!btree</span>
<span class="w">  </span><span class="nt">Claws</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Year</span><span class="p">:</span><span class="w"> </span><span class="nv">2014</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">Road To Burn</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Year</span><span class="p">:</span><span class="w"> </span><span class="nv">2011</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">Vidage</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Year</span><span class="p">:</span><span class="w"> </span><span class="nv">2011</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="nt">Solar Fields</span><span class="p">:</span><span class="w"> </span><span class="kt">!btree</span>
<span class="w">  </span><span class="nt">Sombrero</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Year</span><span class="p">:</span><span class="w"> </span><span class="nv">2011</span><span class="w"> </span><span class="p p-Indicator">}</span>
</code></pre></div>
<div class="highlight code-container"><pre class="code" data-lang="YAML"><span></span><code><span class="c1"># table Music (partition key: Artist, LSI sort key: Year)</span>
<span class="nt">1000mods</span><span class="p">:</span><span class="w"> </span><span class="kt">!btree</span>
<span class="w">  </span><span class="nt">2011</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Song</span><span class="p">:</span><span class="w"> </span><span class="nv">Vidage</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">2011</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Song</span><span class="p">:</span><span class="w"> </span><span class="nv">Road To Burn</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">2014</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Song</span><span class="p">:</span><span class="w"> </span><span class="nv">Claws</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="nt">Solar Fields</span><span class="p">:</span><span class="w"> </span><span class="kt">!btree</span>
<span class="w">  </span><span class="nt">2011</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> Song</span><span class="p">:</span><span class="w"> </span><span class="nv">Sombrero</span><span class="w"> </span><span class="p p-Indicator">}</span>
</code></pre></div>
</section>
<p>Unlike <abbr title="Global Secondary Index">GSI</abbr>s, local secondary indexes support
retrieving attributes <em>not</em> projected into the index
(with higher latency and cost),
and strongly consistent reads.</p>
<p>However, <abbr title="Local Secondary Index">LSI</abbr>s have their downsides:
they can only be created/deleted with the table,
and <strong>using <abbr title="Local Secondary Index">LSI</abbr>s limits partition size to 10 GB</strong>
(the size of the items in the table plus the items in <abbr title="Local Secondary Index">LSI</abbr>s);
because of this, people usually prefer using <abbr title="Global Secondary Index">GSI</abbr>s.</p>
<section class="admonition tip">
<p class="admonition-title">See also</p>
<ul>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/LSI.html">Local secondary indexes</a></li>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/bp-indexes.html">Best practices for secondary indexes</a></li>
</ul>
</section>
<h2 id="features">Features<span class="headerlink">&nbsp;<a href="#features" title="permalink">#</a></span></h2>
<p>Before we go into how to structure data for efficient use with DynamoDB,
let's look at some of the things you can do with tables
besides simple <abbr title="create, read, update, and delete">CRUD</abbr> operations.</p>
<h3 id="eventual-consistency">Eventual consistency<span class="headerlink">&nbsp;<a href="#eventual-consistency" title="permalink">#</a></span></h3>
<p>By default, when reading an item,
the result may be a slightly older version of the data than the most current one;
if you repeat the read, you will eventually get the most recent item,
i.e. reads are <strong>eventually consistent</strong>.
(In part, this is a consequence DynamoDB replicating your data in <a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Introduction.html#ddb-intro-resilience">multiple availability zones</a>
– the node you're talking to may have not gotten the most recent data yet.)</p>
<p>For tables and <abbr title="Local Secondary Index">LSI</abbr>s, you can issue strongly-consistent reads,
which will give you the most up-to-date data;
these are slower, and twice as expensive.</p>
<p>To deal with the lack of a point-in time consistent view of the entire database,
DynamoDB offers <a class="anchor" href="#conditional-updates">conditional updates</a>,
as well as a limited form of <a class="anchor" href="#transactions">transactions</a>,
which serve as a sort of synchronization primitives.</p>
<p>Note that strongly-consistent reads do not remove
the need for synchronization primitives
– by the time you get the response,
the data may have already been updated by another processl
instead,
strong consistency is useful
to lower the rate at which conditional updates or transactions fail.</p>
<section class="admonition tip">
<p class="admonition-title">See also</p>
<ul>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.ReadConsistency.html">DynamoDB read consistency</a></li>
</ul>
</section>
<h3 id="conditional-updates">Conditional updates<span class="headerlink">&nbsp;<a href="#conditional-updates" title="permalink">#</a></span></h3>
<p>For write operations (put/update/delete),
you can specify a <strong>condition expression</strong>
(e.g. an attribute exists, or has a specific value)
that must be true for the operation to happen;
if the expression evaluates to false,
the write fails.</p>
<p>Condition expressions are crucial for ensuring consistency
(and avoiding <a class="external" href="https://en.wikipedia.org/wiki/Time-of-check_to_time-of-use">time-of-check to time-of-use</a> bugs),
since they are the only way to run a bit of logic &quot;server-side&quot;,
on the <em>current</em> version of an item.
Note that the condition can refer only to the item being modified.</p>
<p>Higher level things can be built on top of condition expressions,
including <a class="internal" href="/dynamodb-patterns#optimistic-locking">optimistic locking</a> and <a class="external" href="https://github.com/awslabs/amazon-dynamodb-lock-client">distributed locks</a>.</p>
<section class="admonition tip">
<p class="admonition-title">See also</p>
<ul>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Expressions.ConditionExpressions.html">DynamoDB condition expression CLI example</a></li>
<li><small>(unofficial)</small> <a class="external" href="https://www.alexdebrie.com/posts/dynamodb-condition-expressions/">Understanding DynamoDB Condition Expressions</a></li>
</ul>
</section>
<h3 id="transactions">Transactions<span class="headerlink">&nbsp;<a href="#transactions" title="permalink">#</a></span></h3>
<p>Transactions allow performing write operations (put/update/delete)
to up to 100 items as a single all-or-nothing operation –
either all of them succeed, or none do.
The items can be in the same or <em>different</em> tables
in the same account and region.</p>
<p>Transactions also work with <a class="anchor" href="#conditional-updates">condition expressions</a>,
so if a condition fails for one item,
none of the items are modified.
If you want to evaluate a condition for an item that you're not modifying,
you can use the special <a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_ConditionCheck.html">ConditionCheck</a> operation.
Just like with single condition expressions,
the expressions can only refer to each item individually
(you can't have a condition about two items in the transaction).</p>
<p>You can also read up to 100 items transactionally
(to ensure serialization with transactional writes).</p>
<section class="admonition tip">
<p class="admonition-title">See also</p>
<ul>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/transactions.html">Working with transactions</a></li>
</ul>
</section>
<h3 id="batch-operations">Batch operations<span class="headerlink">&nbsp;<a href="#batch-operations" title="permalink">#</a></span></h3>
<p>You can put/delete up to 25 items or get up to 100 items
in a single request up to 16 MB in size;
this allows reading / writing / deleting large amounts of data efficiently.</p>
<p>The operations within a batch are entirely independent from one another –
some of the operations may fail / a partial result may be returned
(e.g. if <a class="anchor" href="#partition-throughput">throughput limits</a> are reached).
Also, batch writes don't support condition expressions.</p>
<section class="admonition tip">
<p class="admonition-title">See also</p>
<ul>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_BatchGetItem.html">BatchGetItem</a></li>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_BatchWriteItem.html">BatchWriteItem</a></li>
</ul>
</section>
<h3 id="streams">Streams<span class="headerlink">&nbsp;<a href="#streams" title="permalink">#</a></span></h3>
<p>Streams are DynamoDB's <a class="external" href="https://en.wikipedia.org/wiki/Change_data_capture">change data capture</a> mechanism,
and allow you to get notified in &quot;near-real time&quot;
when an item is created, updated, or deleted.
There are two flavors of streams,
<a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Streams.html">DynamoDB Streams</a> (the original one)
and <a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/kds.html">Kinesis Data Streams</a> (integration with Amazon Kinesis).</p>
<p>Two notable applications of streams are:</p>
<ul>
<li>Lambda triggers (similar to triggers in relational databases)</li>
<li>replication to other places like S3 or Redshift (via Firehose)</li>
</ul>
<section class="admonition tip">
<p class="admonition-title">See also</p>
<ul>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.CoreComponents.html#HowItWorks.CoreComponents.Streams">Core components # DynamoDB Streams</a></li>
<li><a class="external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/streamsmain.html">Working with streams</a></li>
<li><small>(unofficial)</small> <a class="external" href="https://www.alexdebrie.com/bites/dynamodb-streams/">What you should know about DynamoDB Streams</a></li>
</ul>
</section>
<section class="footnotes">
<ol>
<li id="fn-1"><p>sortless tables are degenerate cases of sort key being constant;
since ddb doesn't allow adding a sort key after tbale was created,
safe to assume there's actually obtimizations <a href="#fnref-1" class="footnote"><sup>[return]</sup></a></p></li>
<li id="fn-2"><p>TODO: unless you use reserved capacity <a href="#fnref-2" class="footnote"><sup>[return]</sup></a></p></li>
</ol>
</section>








</div>
</main>


<footer class="footer">
<p class="text-gray">
<a href="/">home</a>
∙ <a href="/_feed/index.xml">feed</a>
∙ <a href="/about">about</a>

∙ © 2021 lemon24



</footer>


</div>